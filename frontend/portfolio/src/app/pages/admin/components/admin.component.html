<div class="app-row form-box">
  <mat-tab-group (selectedIndexChange)="changedTab($event)">
    <mat-tab label="_____">Select a tab</mat-tab>
    <mat-tab label="Home">
      <form [formGroup]="f" *ngIf="service.homeForm as f">
        <mat-form-field>
          <mat-label>Mobile tap message</mat-label>
          <input matInput formControlName="mobileTap">
        </mat-form-field>
        <div>
          <h2>Title</h2>
          <div
            *ngFor="let control of formArray(f, 'title').controls as controls; index as i"
            class="flex-column"
          >
            <h3>Item {{ i + 1 }}</h3>
            <mat-checkbox [formControl]="formControl(control, 'accent')">With accent</mat-checkbox>
            <mat-form-field>
              <mat-label>Text to show</mat-label>
              <input matInput [formControl]="formControl(control, 'text')">
            </mat-form-field>
            <mat-form-field>
              <mat-label>Text to show on hover</mat-label>
              <input matInput [formControl]="formControl(control, 'textHover')">
            </mat-form-field>
            <mat-form-field>
              <mat-label>Url it points to</mat-label>
              <mat-select [formControl]="formControl(control, 'url')">
                <mat-option *ngFor="let route of Routes; index as i" [value]="Routes[i]">{{ RouteKeys[i] }}</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field>
              <mat-label>Small text on the right?</mat-label>
              <input matInput [formControl]="formControl(control, 'mini')">
            </mat-form-field>
            <hr>
            <button
              mat-button (click)="formArray(f, 'title').removeAt(i)" class="mat-error"
            >remove item {{ i + 1 }}</button>
          </div>
          <button mat-button (click)="addTitleControl(formArray(f, 'title'))" class="mat-accent">+ add item</button>
        </div>
        <button mat-button (click)="saveHomeForm()">Save</button>
      </form>
    </mat-tab>
    <mat-tab label="About">
      <form [formGroup]="f" *ngIf="service.aboutForm as f" class="flex-column">
        <h2>Title</h2>
        <mat-form-field>
          <mat-label>First</mat-label>
          <input matInput [formControl]="formControl(f, 'title.first')">
        </mat-form-field>
        <div class="ml-20 flex-column">
          <div *ngFor="let multi of formArray(f, 'title.multi').controls; index as i" class="flex-row">
            <mat-form-field>
              <input matInput [formControl]="multi">
            </mat-form-field>
            <button
              mat-button (click)="formArray(f, 'title.multi').removeAt(i)" class="mat-error"
            >remove item {{ i + 1 }}</button>
          </div>
          <button mat-button (click)="addFormControl(formArray(f, 'title.multi'))" class="mat-accent">+ add item</button>
        </div>
        <mat-form-field>
          <mat-label>Last</mat-label>
          <input matInput [formControl]="formControl(f, 'title.last')">
        </mat-form-field>
        <mat-form-field>
          <mat-label>Period</mat-label>
          <input matInput [formControl]="formControl(f, 'title.period')" [maxLength]="3">
        </mat-form-field>
        <hr>
        <ng-container *ngTemplateOutlet="textContent;context:{form: f}"></ng-container>
        <button mat-button (click)="saveAboutForm()">Save</button>
      </form>
    </mat-tab>
    <mat-tab label="Contact">
      <form [formGroup]="f" *ngIf="service.contactForm as f" class="flex-column">
        <mat-form-field>
          <mat-label>Title</mat-label>
          <input matInput [formControl]="formControl(f, 'title')">
        </mat-form-field>
        <hr>
        <ng-container *ngTemplateOutlet="textContent;context:{form: f}"></ng-container>
        <ng-container *ngTemplateOutlet="linkContent;context:{form: f}"></ng-container>
        <button mat-button (click)="saveContactForm()">Save</button>
      </form>

    </mat-tab>
    <mat-tab label="Work">
      <form [formGroup]="f" *ngIf="service.workForm as f" class="flex-column">
        <mat-form-field>
          <mat-label>Title</mat-label>
          <input matInput [formControl]="formControl(f, 'title')">
        </mat-form-field>
        <hr>
        <ng-container *ngTemplateOutlet="textContent;context:{form: f}"></ng-container>
        <button mat-button (click)="saveWorkForm()">Save</button>
      </form>
    </mat-tab>
  </mat-tab-group>
</div>

<ng-template #textContent let-form="form">
  <h2>Text</h2>
  <div *ngFor="let control of formArray(form, 'text').controls; index as i" class="flex-column">
    <mat-form-field>
      <mat-label>Type</mat-label>
      <mat-select [formControl]="formControl(control, 'type')">
        <mat-option [value]="'p'">&lt;p&gt;</mat-option>
        <mat-option [value]="'hr'">&lt;hr&gt;</mat-option>
        <mat-option [value]="'img'">&lt;img&gt;</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Content</mat-label>
      <textarea matInput [formControl]="formControl(control, 'content')" rows="15"></textarea>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Extra?</mat-label>
      <input matInput [formControl]="formControl(control, 'extra')">
    </mat-form-field>
    <button
      mat-button (click)="formArray(form, 'text').removeAt(i)" class="mat-error">remove item {{ i + 1 }}</button>
  </div>
  <button mat-button (click)="addFormControl(formArray(form, 'text'))" class="mat-accent">+ add item</button>
</ng-template>

<ng-template #linkContent let-form="form">
  <h2>Links</h2>
  <div *ngFor="let control of formArray(form, 'link').controls; index as i" class="flex-column">
    <mat-form-field>
      <mat-label>Type</mat-label>
      <input matInput [formControl]="formControl(control, 'text')"/>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Content</mat-label>
      <input matInput [formControl]="formControl(control, 'url')"/>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Extra?</mat-label>
      <input matInput [formControl]="formControl(control, 'title')">
    </mat-form-field>
    <button
      mat-button (click)="formArray(form, 'link').removeAt(i)" class="mat-error">remove item {{ i + 1 }}</button>
  </div>
  <button mat-button (click)="addFormControl(formArray(form, 'link'))" class="mat-accent">+ add item</button>
</ng-template>
