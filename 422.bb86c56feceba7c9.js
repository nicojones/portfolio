"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[422],{8422:(Fv,Ha,R)=>{R.r(Ha),R.d(Ha,{AboutModule:()=>Lv});var Ws=R(6533),Ud=R(5759),Bd=R(6382),qd=R(5774),Ys=R(136),Gd=R(2399);const Kd={title:"More on Goodreads.com",link:"https://www.goodreads.com/review/list/48022935-nico-jones?ref=nav_mybooks&shelf=read",image:"/assets/images/nico.png",descr:"These are the books I have read in the last years. If you would like to see the complete list of books, please visit my profile on Goodreads.",pages:null};var g=R(4537),Qt=R(8692),jd=R(4488),$d=R(1065);function Qd(n,e){if(1&n&&(g.ynx(0),g._UZ(1,"span",6)(2,"span",7),g.BQk()),2&n){const t=e.$implicit,r=e.index,s=g.oxw();g.xp6(1),g.ekj("shown",s.plusIndex%s.aboutPage.title.first.length===r),g.Q6J("innerHTML",t,g.oJD),g.xp6(1),g.Q6J("innerHTML",t,g.oJD)}}function zd(n,e){if(1&n&&(g.ynx(0),g._UZ(1,"span",6)(2,"span",7),g.BQk()),2&n){const t=e.$implicit,r=e.index,s=g.oxw();g.xp6(1),g.ekj("shown",s.plusIndex%s.aboutPage.title.multi.length===r),g.Q6J("innerHTML",t,g.oJD),g.xp6(1),g.Q6J("innerHTML",t,g.oJD)}}function Zd(n,e){if(1&n&&(g.ynx(0),g._UZ(1,"span",6)(2,"span",7),g.BQk()),2&n){const t=e.$implicit,r=e.index,s=g.oxw();g.xp6(1),g.ekj("shown",s.plusIndex%s.aboutPage.title.last.length===r),g.Q6J("innerHTML",t,g.oJD),g.xp6(1),g.Q6J("innerHTML",t,g.oJD)}}function Hd(n,e){1&n&&(g.ynx(0),g._uU(1,"no books."),g.BQk())}function Wd(n,e){1&n&&(g.ynx(0),g._uU(1,"one book."),g.BQk())}function Yd(n,e){if(1&n&&(g.ynx(0),g._uU(1),g.BQk()),2&n){const t=g.oxw(2);g.xp6(1),g.AsE(" ",null==t.shelf.reading?null:t.shelf.reading.reading," books, among them ",t.shelf.reading.books[0].title,". ")}}function Xd(n,e){if(1&n&&g._UZ(0,"app-carousel",14),2&n){const t=g.oxw(2);g.Q6J("books",t.shelf.read.books)("title",t.title)("wrap",!0)("totalBooks",t.shelf.read.totalRead)("lastBook",t.lastBook)}}function Jd(n,e){if(1&n&&(g.ynx(0),g.TgZ(1,"p",8),g._uU(2,"Currently reading "),g.ynx(3,9),g.YNc(4,Hd,2,0,"ng-container",10),g.YNc(5,Wd,2,0,"ng-container",10),g.YNc(6,Yd,2,2,"ng-container",11),g.BQk(),g._uU(7," You can see them "),g.TgZ(8,"a",12),g._uU(9,"here"),g.qZA(),g._uU(10,". "),g.qZA(),g.YNc(11,Xd,1,5,"app-carousel",13),g.BQk()),2&n){const t=g.oxw();g.xp6(3),g.Q6J("ngSwitch",t.shelf.reading.reading),g.xp6(1),g.Q6J("ngSwitchCase",0),g.xp6(1),g.Q6J("ngSwitchCase",1),g.xp6(3),g.Q6J("routerLink","/"+t.RouteUrls.READING),g.xp6(3),g.Q6J("ngIf",null==t.shelf.read?null:t.shelf.read.books)}}let ef=(()=>{class n{constructor(t,r,s){this.route=t,this.booksService=r,this.ref=s,this.RouteUrls=Bd.M,this.shelf=Ys.yM.shelf,this.lastBook=Kd,this.title="books I've read",this.plusIndex=0,this.aboutPage=this.route.snapshot.data.aboutPage,(0,Gd.$)(this.booksService.getCurrentlyReading(),this.booksService.getReadBooks()).subscribe(()=>this.ref.markForCheck()),setInterval(()=>{++this.plusIndex,this.ref.markForCheck()},5e3)}}return n.\u0275fac=function(t){return new(t||n)(g.Y36(Ws.gz),g.Y36(Ys.yM),g.Y36(g.sBO))},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-about"]],decls:10,vars:7,consts:[[1,"jumbo","center","landing"],[1,"plus-box","slide-in"],[4,"ngFor","ngForOf"],[1,"app-row","bottom-padding"],[1,"text","flex-column",3,"text"],[4,"ngIf"],[1,"absolute",3,"innerHTML"],[1,"relative",3,"innerHTML"],[1,"text","slide-in"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"routerLink"],[3,"books","title","wrap","totalBooks","lastBook",4,"ngIf"],[3,"books","title","wrap","totalBooks","lastBook"]],template:function(t,r){1&t&&(g.TgZ(0,"h1",0)(1,"span",1),g.YNc(2,Qd,3,4,"ng-container",2),g.qZA(),g.TgZ(3,"span",1),g.YNc(4,zd,3,4,"ng-container",2),g.qZA(),g.TgZ(5,"span",1),g.YNc(6,Zd,3,4,"ng-container",2),g.qZA()(),g.TgZ(7,"div",3),g._UZ(8,"app-text",4),g.YNc(9,Jd,12,5,"ng-container",5),g.qZA()),2&t&&(g.Q6J("@slideIn",void 0),g.xp6(2),g.Q6J("ngForOf",r.aboutPage.title.first),g.xp6(2),g.Q6J("ngForOf",r.aboutPage.title.multi),g.xp6(2),g.Q6J("ngForOf",r.aboutPage.title.last),g.xp6(1),g.Q6J("@slideIn",void 0),g.xp6(1),g.Q6J("text",r.aboutPage.text),g.xp6(1),g.Q6J("ngIf",r.shelf.reading))},dependencies:[Ws.yS,Qt.sg,Qt.O5,Qt.RF,Qt.n9,Qt.ED,jd.F,$d.T],styles:[".plus-box[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center}.plus-box[_ngcontent-%COMP%] > span.absolute[_ngcontent-%COMP%]{transition:.4s all;position:absolute;opacity:0}.plus-box[_ngcontent-%COMP%] > span.absolute.shown[_ngcontent-%COMP%]{opacity:1}.plus-box[_ngcontent-%COMP%] > span.relative[_ngcontent-%COMP%]{opacity:0;color:transparent;position:relative;visibility:hidden}app-carousel[_ngcontent-%COMP%]{margin-top:50px}"],data:{animation:[(0,qd.Y)()]},changeDetection:0}),n})();var tf=R(6018),nf=R(3738);let Wa=(()=>{class n{constructor(t){this.firebaseApi=t}resolve(){return this.firebaseApi.fetchPageDocument("ABOUT")}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(nf.R))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac}),n})();var rf=R(1540),sf=R(4346),of=R(5828),bn=R(4112),Ya=R(4323),Ne=R(3162),af=R(4581),Xa=R(8328);function Ja(...n){return function uf(){return(0,af.J)(1)}()((0,bn.D)(n,(0,Xa.yG)(n)))}var eu=R(3201);function Xs(...n){const e=(0,Xa.yG)(n);return(0,eu.e)((t,r)=>{(e?Ja(n,t,e):Ja(n,t)).subscribe(r)})}var cf=R(1894);function Js(){return(0,eu.e)((n,e)=>{let t,r=!1;n.subscribe((0,cf.x)(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var S,Me=R(6885),ei=R(1565),lf=R(5488),tu=R(1971),kr=R(8939),hf=(R(5798),R(3394)),y=R(8239),Rr=R(8026),nu=R(3910),pt=R(5422),q=R(3854),df=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qe={},ti=ti||{},A=df||self;function Mr(){}function Lr(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Sn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ni="closure_uid_"+(1e9*Math.random()>>>0),mf=0;function gf(n,e,t){return n.call.apply(n.bind,arguments)}function pf(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function pe(n,e,t){return(pe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?gf:pf).apply(null,arguments)}function Fr(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function he(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function We(){this.s=this.s,this.o=this.o}var vf={};We.prototype.s=!1,We.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function ff(n){return Object.prototype.hasOwnProperty.call(n,ni)&&n[ni]||(n[ni]=++mf)}(this);delete vf[n]}},We.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ru=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function ri(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function su(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Lr(r)){const s=n.length||0,i=r.length||0;n.length=s+i;for(let o=0;o<i;o++)n[s+o]=r[o]}else n.push(r)}}function ye(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ye.prototype.h=function(){this.defaultPrevented=!0};var wf=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{A.addEventListener("test",Mr,e),A.removeEventListener("test",Mr,e)}catch{}return n}();function Or(n){return/^[\s\xa0]*$/.test(n)}var iu=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function si(n,e){return n<e?-1:n>e?1:0}function Pr(){var n=A.navigator;return n&&(n=n.userAgent)?n:""}function Le(n){return-1!=Pr().indexOf(n)}function ii(n){return ii[" "](n),n}ii[" "]=Mr;var Vr,n,_f=Le("Opera"),zt=Le("Trident")||Le("MSIE"),ou=Le("Edge"),oi=ou||zt,au=Le("Gecko")&&!(-1!=Pr().toLowerCase().indexOf("webkit")&&!Le("Edge"))&&!(Le("Trident")||Le("MSIE"))&&!Le("Edge"),xf=-1!=Pr().toLowerCase().indexOf("webkit")&&!Le("Edge");function uu(){var n=A.document;return n?n.documentMode:void 0}e:{var ai="",ui=(n=Pr(),au?/rv:([^\);]+)(\)|;)/.exec(n):ou?/Edge\/([\d\.]+)/.exec(n):zt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):xf?/WebKit\/(\S+)/.exec(n):_f?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(ui&&(ai=ui?ui[1]:""),zt){var ci=uu();if(null!=ci&&ci>parseFloat(ai)){Vr=String(ci);break e}}Vr=ai}var Ef={};var bf=A.document&&zt&&(uu()||parseInt(Vr,10))||void 0;function Cn(n,e){if(ye.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(au){e:{try{ii(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Sf[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Cn.X.h.call(this)}}he(Cn,ye);var Sf={2:"touch",3:"pen",4:"mouse"};Cn.prototype.h=function(){Cn.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Dn="closure_listenable_"+(1e6*Math.random()|0),Cf=0;function Df(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=s,this.key=++Cf,this.ba=this.ea=!1}function Ur(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function hi(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function lu(n){const e={};for(const t in n)e[t]=n[t];return e}const hu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function du(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<hu.length;i++)t=hu[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Br(n){this.src=n,this.g={},this.h=0}function di(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=ru(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Ur(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function fi(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ba&&i.listener==e&&i.capture==!!t&&i.ha==r)return s}return-1}Br.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=fi(n,e,r,s);return-1<o?(e=n[o],t||(e.ea=!1)):((e=new Df(e,this.src,i,!!r,s)).ea=t,n.push(e)),e};var mi="closure_lm_"+(1e6*Math.random()|0),gi={};function fu(n,e,t,r,s){if(r&&r.once)return gu(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)fu(n,e[i],t,r,s);return null}return t=wi(t),n&&n[Dn]?n.N(e,t,Sn(r)?!!r.capture:!!r,s):mu(n,e,t,!1,r,s)}function mu(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=Sn(s)?!!s.capture:!!s,a=yi(n);if(a||(n[mi]=a=new Br(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function Af(){const e=Nf;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)wf||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(yu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function gu(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)gu(n,e[i],t,r,s);return null}return t=wi(t),n&&n[Dn]?n.O(e,t,Sn(r)?!!r.capture:!!r,s):mu(n,e,t,!0,r,s)}function pu(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)pu(n,e[i],t,r,s);else r=Sn(r)?!!r.capture:!!r,t=wi(t),n&&n[Dn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=fi(i=n.g[e],t,r,s))&&(Ur(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=yi(n))&&(e=n.g[e.toString()],n=-1,e&&(n=fi(e,t,r,s)),(t=-1<n?e[n]:null)&&pi(t))}function pi(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[Dn])di(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(yu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=yi(e))?(di(t,n),0==t.h&&(t.src=null,e[mi]=null)):Ur(n)}}}function yu(n){return n in gi?gi[n]:gi[n]="on"+n}function Nf(n,e){if(n.ba)n=!0;else{e=new Cn(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&pi(n),n=t.call(r,e)}return n}function yi(n){return(n=n[mi])instanceof Br?n:null}var vi="__closure_events_fn_"+(1e9*Math.random()>>>0);function wi(n){return"function"==typeof n?n:(n[vi]||(n[vi]=function(e){return n.handleEvent(e)}),n[vi])}function oe(){We.call(this),this.i=new Br(this),this.P=this,this.I=null}function de(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new ye(e,n);else if(e instanceof ye)e.target=e.target||n;else{var s=e;du(e=new ye(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=qr(o,r,!0,e)&&s}if(s=qr(o=e.g=n,r,!0,e)&&s,s=qr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=qr(o=e.g=t[i],r,!1,e)&&s}function qr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==t){var a=o.listener,u=o.ha||o.src;o.ea&&di(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}he(oe,We),oe.prototype[Dn]=!0,oe.prototype.removeEventListener=function(n,e,t,r){pu(this,n,e,t,r)},oe.prototype.M=function(){if(oe.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ur(t[r]);delete n.g[e],n.h--}}this.I=null},oe.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},oe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Ii=A.JSON.stringify;function kf(){var n=Iu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var _i,vu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Mf,n=>n.reset());class Mf{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Lf(n){A.setTimeout(()=>{throw n},0)}function wu(n,e){_i||function Ff(){var n=A.Promise.resolve(void 0);_i=function(){n.then(Of)}}(),xi||(_i(),xi=!0),Iu.add(n,e)}var xi=!1,Iu=new class Rf{constructor(){this.h=this.g=null}add(e,t){const r=vu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function Of(){for(var n;n=kf();){try{n.h.call(n.g)}catch(t){Lf(t)}var e=vu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}xi=!1}function Gr(n,e){oe.call(this),this.h=n||1,this.g=e||A,this.j=pe(this.lb,this),this.l=Date.now()}function Ei(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function Ti(n,e,t){if("function"==typeof n)t&&(n=pe(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=pe(n.handleEvent,n)}return 2147483647<Number(e)?-1:A.setTimeout(n,e||0)}function _u(n){n.g=Ti(()=>{n.g=null,n.i&&(n.i=!1,_u(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}he(Gr,oe),(S=Gr.prototype).ca=!1,S.R=null,S.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),de(this,"tick"),this.ca&&(Ei(this),this.start()))}},S.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},S.M=function(){Gr.X.M.call(this),Ei(this),delete this.g};class Pf extends We{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:_u(this)}M(){super.M(),this.g&&(A.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function An(n){We.call(this),this.h=n,this.g={}}he(An,We);var xu=[];function Eu(n,e,t,r){Array.isArray(t)||(t&&(xu[0]=t.toString()),t=xu);for(var s=0;s<t.length;s++){var i=fu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Tu(n){hi(n.g,function(e,t){this.g.hasOwnProperty(t)&&pi(e)},n),n.g={}}function Kr(){this.g=!0}function Zt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function qf(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ii(t)}catch{return e}}(n,t)+(r?" "+r:"")})}An.prototype.M=function(){An.X.M.call(this),Tu(this)},An.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kr.prototype.Aa=function(){this.g=!1},Kr.prototype.info=function(){};var yt={},bu=null;function jr(){return bu=bu||new oe}function Su(n){ye.call(this,yt.Pa,n)}function Nn(n){const e=jr();de(e,new Su(e,n))}function Cu(n,e){ye.call(this,yt.STAT_EVENT,n),this.stat=e}function we(n){const e=jr();de(e,new Cu(e,n))}function Du(n,e){ye.call(this,yt.Qa,n),this.size=e}function kn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){n()},e)}yt.Pa="serverreachability",he(Su,ye),yt.STAT_EVENT="statevent",he(Cu,ye),yt.Qa="timingevent",he(Du,ye);var $r={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Au={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function bi(){}function ku(){}bi.prototype.h=null;var Di,Rn={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Si(){ye.call(this,"d")}function Ci(){ye.call(this,"c")}function Qr(){}function Mn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new An(this),this.O=Gf,this.T=new Gr(n=oi?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Ru}function Ru(){this.i=null,this.g="",this.h=!1}he(Si,ye),he(Ci,ye),he(Qr,bi),Qr.prototype.g=function(){return new XMLHttpRequest},Qr.prototype.i=function(){return{}},Di=new Qr;var Gf=45e3,Ai={},zr={};function Ni(n,e,t){n.K=1,n.v=Yr(Ge(e)),n.s=t,n.P=!0,Mu(n,null)}function Mu(n,e){n.F=Date.now(),Ln(n),n.A=Ge(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),Ku(t.i,"t",r),n.C=0,t=n.l.H,n.h=new Ru,n.g=fc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new Pf(pe(n.La,n,n.g),n.N)),Eu(n.S,n.g,"readystatechange",n.ib),e=n.H?lu(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Nn(1),function Vf(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Lu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Fu(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=Kf(n,t),s==zr){4==e&&(n.o=4,we(14),r=!1),Zt(n.j,n.m,null,"[Incomplete Response]");break}if(s==Ai){n.o=4,we(15),Zt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Zt(n.j,n.m,s,null),ki(n,s)}Lu(n)&&s!=zr&&s!=Ai&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,we(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ui(e),e.K=!0,we(11))):(Zt(n.j,n.m,t,"[Invalid Chunked Response]"),vt(n),Fn(n))}function Kf(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?zr:(t=Number(e.substring(t,r)),isNaN(t)?Ai:(r+=1)+t>e.length?zr:(e=e.substr(r,t),n.C=r+t,e))}function Ln(n){n.V=Date.now()+n.O,Ou(n,n.O)}function Ou(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=kn(pe(n.gb,n),e)}function Zr(n){n.B&&(A.clearTimeout(n.B),n.B=null)}function Fn(n){0==n.l.G||n.I||cc(n.l,n)}function vt(n){Zr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,Ei(n.T),Tu(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function ki(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ri(t.h,n)))if(!n.J&&Ri(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;rs(t),ts(t)}Vi(t),we(18)}}else t.Ba=s[1],0<t.Ba-t.T&&37500>s[2]&&t.L&&0==t.A&&!t.v&&(t.v=kn(pe(t.cb,t),6e3));if(1>=Qu(t.h)&&t.ja){try{t.ja()}catch{}t.ja=void 0}}else It(t,11)}else if((n.J||t.g==n)&&rs(t),!Or(e))for(s=t.Fa.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.T=c[0],c=c[1],2==t.G)if("c"==c[0]){t.I=c[1],t.ka=c[2];const l=c[3];null!=l&&(t.ma=l,t.j.info("VER="+t.ma));const h=c[4];null!=h&&(t.Ca=h,t.j.info("SVER="+t.Ca));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.J=r=1.5*d,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const v=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(v){var i=r.h;i.g||-1==v.indexOf("spdy")&&-1==v.indexOf("quic")&&-1==v.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Mi(i,i.h),i.h=null))}if(r.D){const E=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;E&&(r.za=E,Q(r.F,r.D,E))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var o=n;if((r=t).sa=dc(r,r.H?r.ka:null,r.V),o.J){zu(r.h,o);var a=o,u=r.J;u&&a.setTimeout(u),a.B&&(Zr(a),Ln(a)),r.g=o}else ac(r);0<t.i.length&&ns(t)}else"stop"!=c[0]&&"close"!=c[0]||It(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?It(t,7):Pi(t):"noop"!=c[0]&&t.l&&t.l.wa(c),t.A=0)}Nn(4)}catch{}}function Pu(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Lr(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function $f(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Lr(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function jf(n){if(n.W&&"function"==typeof n.W)return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Lr(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}(S=Mn.prototype).setTimeout=function(n){this.O=n},S.ib=function(n){n=n.target;const e=this.L;e&&3==Ke(n)?e.l():this.La(n)},S.La=function(n){try{if(n==this.g)e:{const l=Ke(this.g);var e=this.g.Ea();const h=this.g.aa();if(!(3>l)&&(3!=l||oi||this.g&&(this.h.h||this.g.fa()||tc(this.g)))){this.I||4!=l||7==e||Nn(8==e||0>=h?3:2),Zr(this);var t=this.g.aa();this.Y=t;t:if(Lu(this)){var r=tc(this.g);n="";var s=r.length,i=4==Ke(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){vt(this),Fn(this);var o="";break t}this.h.i=new A.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==t,function Uf(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.U,l,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Or(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,we(12),vt(this),Fn(this);break e}Zt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,ki(this,t)}this.P?(Fu(this,l,o),oi&&this.i&&3==l&&(Eu(this.S,this.T,"tick",this.hb),this.T.start())):(Zt(this.j,this.m,o,null),ki(this,o)),4==l&&vt(this),this.i&&!this.I&&(4==l?cc(this.l,this):(this.i=!1,Ln(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,we(12)):(this.o=0,we(13)),vt(this),Fn(this)}}}catch{}},S.hb=function(){if(this.g){var n=Ke(this.g),e=this.g.fa();this.C<e.length&&(Zr(this),Fu(this,n,e),this.i&&4!=n&&Ln(this))}},S.cancel=function(){this.I=!0,vt(this)},S.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function Bf(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Nn(3),we(17)),vt(this),this.o=2,Fn(this)):Ou(this,this.V-n)};var Vu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wt(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof wt){this.h=void 0!==e?e:n.h,Hr(this,n.j),this.s=n.s,this.g=n.g,Wr(this,n.m),this.l=n.l,e=n.i;var t=new Vn;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Uu(this,t),this.o=n.o}else n&&(t=String(n).match(Vu))?(this.h=!!e,Hr(this,t[1]||"",!0),this.s=On(t[2]||""),this.g=On(t[3]||"",!0),Wr(this,t[4]),this.l=On(t[5]||"",!0),Uu(this,t[6]||"",!0),this.o=On(t[7]||"")):(this.h=!!e,this.i=new Vn(null,this.h))}function Ge(n){return new wt(n)}function Hr(n,e,t){n.j=t?On(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Wr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Uu(n,e,t){e instanceof Vn?(n.i=e,function Xf(n,e){e&&!n.j&&(Ye(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(qu(this,r),Ku(this,s,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Pn(e,Wf)),n.i=new Vn(e,n.h))}function Q(n,e,t){n.i.set(e,t)}function Yr(n){return Q(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function On(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Pn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,zf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function zf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}wt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Pn(e,Bu,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Pn(e,Bu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Pn(t,"/"==t.charAt(0)?Hf:Zf,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Pn(t,Yf)),n.join("")};var Bu=/[#\/\?@]/g,Zf=/[#\?:]/g,Hf=/[#\?]/g,Wf=/[#\?@]/g,Yf=/#/g;function Vn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Ye(n){n.g||(n.g=new Map,n.h=0,n.i&&function Qf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function qu(n,e){Ye(n),e=Ht(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Gu(n,e){return Ye(n),e=Ht(n,e),n.g.has(e)}function Ku(n,e,t){qu(n,e),0<t.length&&(n.i=null,n.g.set(Ht(n,e),ri(t)),n.h+=t.length)}function Ht(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function ju(n){this.l=n||em,n=A.PerformanceNavigationTiming?0<(n=A.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(A.g&&A.g.Ga&&A.g.Ga()&&A.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(S=Vn.prototype).add=function(n,e){Ye(this),this.i=null,n=Ht(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},S.forEach=function(n,e){Ye(this),this.g.forEach(function(t,r){t.forEach(function(s){n.call(e,s,r,this)},this)},this)},S.oa=function(){Ye(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const s=n[r];for(let i=0;i<s.length;i++)t.push(e[r])}return t},S.W=function(n){Ye(this);let e=[];if("string"==typeof n)Gu(this,n)&&(e=e.concat(this.g.get(Ht(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},S.set=function(n,e){return Ye(this),this.i=null,Gu(this,n=Ht(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},S.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},S.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const i=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),n.push(s)}}return this.i=n.join("&")};var em=10;function $u(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Qu(n){return n.h?1:n.g?n.g.size:0}function Ri(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Mi(n,e){n.g?n.g.add(e):n.h=e}function zu(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Zu(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return ri(n.i)}function Li(){}function tm(){this.g=new Li}function nm(n,e,t){const r=t||"";try{Pu(n,function(s,i){let o=s;Sn(s)&&(o=Ii(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Xr(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch{}}function Un(n){this.l=n.ac||null,this.j=n.jb||!1}function Jr(n,e){oe.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Fi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ju.prototype.cancel=function(){if(this.i=Zu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Li.prototype.stringify=function(n){return A.JSON.stringify(n,void 0)},Li.prototype.parse=function(n){return A.JSON.parse(n,void 0)},he(Un,bi),Un.prototype.g=function(){return new Jr(this.l,this.j)},Un.prototype.i=function(n){return function(){return n}}({}),he(Jr,oe);var Fi=0;function Hu(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function Bn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,qn(n)}function qn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(S=Jr.prototype).open=function(n,e){if(this.readyState!=Fi)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,qn(this)},S.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||A).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Bn(this)),this.readyState=Fi},S.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,qn(this)),this.g&&(this.readyState=3,qn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof A.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Hu(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},S.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Bn(this):qn(this),3==this.readyState&&Hu(this)}},S.Va=function(n){this.g&&(this.response=this.responseText=n,Bn(this))},S.Ua=function(n){this.g&&(this.response=n,Bn(this))},S.ga=function(){this.g&&Bn(this)},S.setRequestHeader=function(n,e){this.v.append(n,e)},S.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Jr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var sm=A.JSON.parse;function H(n){oe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Wu,this.K=this.L=!1}he(H,oe);var Wu="",im=/^https?$/i,om=["POST","PUT"];function Yu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Xu(n),es(n)}function Xu(n){n.D||(n.D=!0,de(n,"complete"),de(n,"error"))}function Ju(n){if(n.h&&typeof ti<"u"&&(!n.C[1]||4!=Ke(n)||2!=n.aa()))if(n.v&&4==Ke(n))Ti(n.Ha,0,n);else if(de(n,"readystatechange"),4==Ke(n)){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Vu)[1]||null;if(!s&&A.self&&A.self.location){var i=A.self.location.protocol;s=i.substr(0,i.length-1)}r=!im.test(s?s.toLowerCase():"")}t=r}if(t)de(n,"complete"),de(n,"success");else{n.m=6;try{var o=2<Ke(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.aa()+"]",Xu(n)}}finally{es(n)}}}function es(n,e){if(n.g){ec(n);const t=n.g,r=n.C[0]?Mr:null;n.g=null,n.C=null,e||de(n,"ready");try{t.onreadystatechange=r}catch{}}}function ec(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(A.clearTimeout(n.A),n.A=null)}function Ke(n){return n.g?n.g.readyState:0}function tc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Wu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function nc(n){let e="";return hi(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Oi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=nc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Q(n,e,t))}function Gn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function rc(n){this.Ca=0,this.i=[],this.j=new Kr,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Gn("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Gn("baseRetryDelayMs",5e3,n),this.bb=Gn("retryDelaySeedMs",1e4,n),this.$a=Gn("forwardChannelMaxRetries",2,n),this.ta=Gn("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new ju(n&&n.concurrentRequestLimit),this.Fa=new tm,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Pi(n){if(sc(n),3==n.G){var e=n.U++,t=Ge(n.F);Q(t,"SID",n.I),Q(t,"RID",e),Q(t,"TYPE","terminate"),Kn(n,t),(e=new Mn(n,n.j,e,void 0)).K=2,e.v=Yr(Ge(t)),t=!1,A.navigator&&A.navigator.sendBeacon&&(t=A.navigator.sendBeacon(e.v.toString(),"")),!t&&A.Image&&((new Image).src=e.v,t=!0),t||(e.g=fc(e.l,null),e.g.da(e.v)),e.F=Date.now(),Ln(e)}hc(n)}function ts(n){n.g&&(Ui(n),n.g.cancel(),n.g=null)}function sc(n){ts(n),n.u&&(A.clearTimeout(n.u),n.u=null),rs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&A.clearTimeout(n.m),n.m=null)}function ns(n){$u(n.h)||n.m||(n.m=!0,wu(n.Ja,n),n.C=0)}function ic(n,e){var t;t=e?e.m:n.U++;const r=Ge(n.F);Q(r,"SID",n.I),Q(r,"RID",t),Q(r,"AID",n.T),Kn(n,r),n.o&&n.s&&Oi(r,n.o,n.s),t=new Mn(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=oc(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Mi(n.h,t),Ni(t,r,e)}function Kn(n,e){n.ia&&hi(n.ia,function(t,r){Q(e,r,t)}),n.l&&Pu({},function(t,r){Q(e,r,t)})}function oc(n,e,t){t=Math.min(n.i.length,t);var r=n.l?pe(n.l.Ra,n.l,n):null;e:{var s=n.i;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const l=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{nm(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function ac(n){n.g||n.u||(n.Z=1,wu(n.Ia,n),n.A=0)}function Vi(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=kn(pe(n.Ia,n),lc(n,n.A)),n.A++,0))}function Ui(n){null!=n.B&&(A.clearTimeout(n.B),n.B=null)}function uc(n){n.g=new Mn(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=Ge(n.sa);Q(e,"RID","rpc"),Q(e,"SID",n.I),Q(e,"CI",n.L?"0":"1"),Q(e,"AID",n.T),Q(e,"TYPE","xmlhttp"),Kn(n,e),n.o&&n.s&&Oi(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Yr(Ge(e)),t.s=null,t.P=!0,Mu(t,n)}function rs(n){null!=n.v&&(A.clearTimeout(n.v),n.v=null)}function cc(n,e){var t=null;if(n.g==e){rs(n),Ui(n),n.g=null;var r=2}else{if(!Ri(n.h,e))return;t=e.D,zu(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;de(r=jr(),new Du(r,t,e,s)),ns(n)}else ac(n);else if(3==(s=e.o)||0==s&&0<n.pa||!(1==r&&function um(n,e){return!(Qu(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=kn(pe(n.Ja,n,e),lc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Vi(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),s){case 1:It(n,5);break;case 4:It(n,10);break;case 3:It(n,6);break;default:It(n,2)}}function lc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function It(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=pe(n.kb,n);t||(t=new wt("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||Hr(t,"https"),Yr(t)),function rm(n,e){const t=new Kr;if(A.Image){const r=new Image;r.onload=Fr(Xr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Fr(Xr,t,r,"TestLoadImage: error",!1,e),r.onabort=Fr(Xr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Fr(Xr,t,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else we(2);n.G=0,n.l&&n.l.va(e),hc(n),sc(n)}function hc(n){if(n.G=0,n.la=[],n.l){const e=Zu(n.h);(0!=e.length||0!=n.i.length)&&(su(n.la,e),su(n.la,n.i),n.h.i.length=0,ri(n.i),n.i.length=0),n.l.ua()}}function dc(n,e,t){var r=t instanceof wt?Ge(t):new wt(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Wr(r,r.m);else{var s=A.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new wt(null,void 0);r&&Hr(i,r),e&&(i.g=e),s&&Wr(i,s),t&&(i.l=t),r=i}return e=n.za,(t=n.D)&&e&&Q(r,t,e),Q(r,"VER",n.ma),Kn(n,r),r}function fc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new H(t&&n.Da&&!n.ra?new Un({jb:!0}):n.ra)).Ka(n.H),e}function mc(){}function ss(){if(zt&&!(10<=Number(bf)))throw Error("Environmental error: no available transport.")}function Ce(n,e){oe.call(this),this.g=new rc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Or(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Or(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Wt(this)}function gc(n){Si.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function pc(){Ci.call(this),this.status=1}function Wt(n){this.g=n}(S=H.prototype).Ka=function(n){this.L=n},S.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Di.g(),this.C=function Nu(n){return n.h||(n.h=n.i())}(this.u?this.u:Di),this.g.onreadystatechange=pe(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Yu(this,i)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)t.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const i of r.keys())t.set(i,r.get(i))}r=Array.from(t.keys()).find(i=>"content-type"==i.toLowerCase()),s=A.FormData&&n instanceof A.FormData,!(0<=ru(om,e))||r||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ec(this),0<this.B&&((this.K=function am(n){return zt&&function Tf(){return function If(n){var e=Ef;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=iu(String(Vr)).split("."),t=iu("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=si(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||si(0==s[2].length,0==i[2].length)||si(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pe(this.qa,this)):this.A=Ti(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Yu(this,i)}},S.qa=function(){typeof ti<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,de(this,"timeout"),this.abort(8))},S.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,de(this,"complete"),de(this,"abort"),es(this))},S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),es(this,!0)),H.X.M.call(this)},S.Ha=function(){this.s||(this.F||this.v||this.l?Ju(this):this.fb())},S.fb=function(){Ju(this)},S.aa=function(){try{return 2<Ke(this)?this.g.status:-1}catch{return-1}},S.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}},S.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),sm(e)}},S.Ea=function(){return this.m},S.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(S=rc.prototype).ma=8,S.G=1,S.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const s=new Mn(this,this.j,n,void 0);let i=this.s;if(this.S&&(i?(i=lu(i),du(i,this.S)):i=this.S),null!==this.o||this.N||(s.H=i,i=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=oc(this,s,e),Q(t=Ge(this.F),"RID",n),Q(t,"CVER",22),this.D&&Q(t,"X-HTTP-Session-Id",this.D),Kn(this,t),i&&(this.N?e="headers="+encodeURIComponent(String(nc(i)))+"&"+e:this.o&&Oi(t,this.o,i)),Mi(this.h,s),this.Ya&&Q(t,"TYPE","init"),this.O?(Q(t,"$req",e),Q(t,"SID","null"),s.Z=!0,Ni(s,t,null)):Ni(s,t,e),this.G=2}}else 3==this.G&&(n?ic(this,n):0==this.i.length||$u(this.h)||ic(this))},S.Ia=function(){if(this.u=null,uc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=kn(pe(this.eb,this),n)}},S.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,we(10),ts(this),uc(this))},S.cb=function(){null!=this.v&&(this.v=null,ts(this),Vi(this),we(19))},S.kb=function(n){n?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))},(S=mc.prototype).xa=function(){},S.wa=function(){},S.va=function(){},S.ua=function(){},S.Ra=function(){},ss.prototype.g=function(n,e){return new Ce(n,e)},he(Ce,oe),Ce.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;we(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=dc(n,null,n.V),ns(n)},Ce.prototype.close=function(){Pi(this.g)},Ce.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Ii(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&ns(e)},Ce.prototype.M=function(){this.g.l=null,delete this.j,Pi(this.g),delete this.g,Ce.X.M.call(this)},he(gc,Si),he(pc,Ci),he(Wt,mc),Wt.prototype.xa=function(){de(this.g,"a")},Wt.prototype.wa=function(n){de(this.g,new gc(n))},Wt.prototype.va=function(n){de(this.g,new pc(n))},Wt.prototype.ua=function(){de(this.g,"b")},ss.prototype.createWebChannel=ss.prototype.g,Ce.prototype.send=Ce.prototype.u,Ce.prototype.open=Ce.prototype.m,Ce.prototype.close=Ce.prototype.close,$r.NO_ERROR=0,$r.TIMEOUT=8,$r.HTTP_ERROR=6,Au.COMPLETE="complete",ku.EventType=Rn,Rn.OPEN="a",Rn.CLOSE="b",Rn.ERROR="c",Rn.MESSAGE="d",oe.prototype.listen=oe.prototype.N,H.prototype.listenOnce=H.prototype.O,H.prototype.getLastError=H.prototype.Oa,H.prototype.getLastErrorCode=H.prototype.Ea,H.prototype.getStatus=H.prototype.aa,H.prototype.getResponseJson=H.prototype.Sa,H.prototype.getResponseText=H.prototype.fa,H.prototype.send=H.prototype.da,H.prototype.setWithCredentials=H.prototype.Ka;var cm=qe.createWebChannelTransport=function(){return new ss},lm=qe.getStatEventTarget=function(){return jr()},Bi=qe.ErrorCode=$r,hm=qe.EventType=Au,dm=qe.Event=yt,yc=qe.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},fm=qe.FetchXmlHttpFactory=Un,is=qe.WebChannel=ku,mm=qe.XhrIo=H;const vc="@firebase/firestore";class ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ae.UNAUTHENTICATED=new ae(null),ae.GOOGLE_CREDENTIALS=new ae("google-credentials-uid"),ae.FIRST_PARTY=new ae("first-party-uid"),ae.MOCK_USER=new ae("mock-user");let Yt="9.12.1";const Xe=new pt.Yd("@firebase/firestore");function qi(){return Xe.logLevel}function I(n,...e){if(Xe.logLevel<=pt.in.DEBUG){const t=e.map(Gi);Xe.debug(`Firestore (${Yt}): ${n}`,...t)}}function ee(n,...e){if(Xe.logLevel<=pt.in.ERROR){const t=e.map(Gi);Xe.error(`Firestore (${Yt}): ${n}`,...t)}}function _t(n,...e){if(Xe.logLevel<=pt.in.WARN){const t=e.map(Gi);Xe.warn(`Firestore (${Yt}): ${n}`,...t)}}function Gi(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function b(n="Unexpected state"){const e=`FIRESTORE (${Yt}) INTERNAL ASSERTION FAILED: `+n;throw ee(e),new Error(e)}function C(n,e){n||b()}function x(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class w extends q.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class re{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class wc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ym{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ae.UNAUTHENTICATED))}shutdown(){}}class vm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class wm{constructor(e){this.t=e,this.currentUser=ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new re;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new re,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,y.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new re)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(C("string"==typeof r.accessToken),new wc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new ae(e)}}class Im{constructor(e,t,r,s){this.h=e,this.l=t,this.m=r,this.g=s,this.type="FirstParty",this.user=ae.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(C(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class _m{constructor(e,t,r,s){this.h=e,this.l=t,this.m=r,this.g=s}getToken(){return Promise.resolve(new Im(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ic{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class xm{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=i=>{null!=i.error&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.A;return this.A=i.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.T.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.T.getImmediate({optional:!0});i?s(i):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(C("string"==typeof t.token),this.A=t.token,new Ic(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Em(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class _c{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Em(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function N(n,e){return n<e?-1:n>e?1:0}function Xt(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function xc(n){return n+"\0"}class z{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new w(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new w(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new w(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new w(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return z.fromMillis(Date.now())}static fromDate(e){return z.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new z(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?N(this.nanoseconds,e.nanoseconds):N(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class D{constructor(e){this.timestamp=e}static fromTimestamp(e){return new D(e)}static min(){return new D(new z(0,0))}static max(){return new D(new z(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class jn{constructor(e,t,r){void 0===t?t=0:t>e.length&&b(),void 0===r?r=e.length-t:r>e.length-t&&b(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===jn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof jn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class L extends jn{construct(e,t,r){return new L(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new w(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new L(t)}static emptyPath(){return new L([])}}const Tm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class W extends jn{construct(e,t,r){return new W(e,t,r)}static isValidIdentifier(e){return Tm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),W.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new W(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new w(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new w(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new w(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new w(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new W(t)}static emptyPath(){return new W([])}}class _{constructor(e){this.path=e}static fromPath(e){return new _(L.fromString(e))}static fromName(e){return new _(L.fromString(e).popFirst(5))}static empty(){return new _(L.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===L.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return L.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _(new L(e.slice()))}}class os{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Ki(n){return n.fields.find(e=>2===e.kind)}function xt(n){return n.fields.filter(e=>2!==e.kind)}os.UNKNOWN_ID=-1;class as{constructor(e,t){this.fieldPath=e,this.kind=t}}class $n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new $n(0,De.min())}}function Ec(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=D.fromTimestamp(1e9===r?new z(t+1,0):new z(t,r));return new De(s,_.empty(),e)}function Tc(n){return new De(n.readTime,n.key,-1)}class De{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new De(D.min(),_.empty(),-1)}static max(){return new De(D.max(),_.empty(),-1)}}function ji(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=_.comparator(n.documentKey,e.documentKey),0!==t?t:N(n.largestBatchId,e.largestBatchId))}const bc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Je(n){return $i.apply(this,arguments)}function $i(){return $i=(0,y.Z)(function*(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==bc)throw n;I("LocalStore","Unexpectedly lost primary lease")}),$i.apply(this,arguments)}class f{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&b(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new f((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof f?t:f.resolve(t)}catch(t){return f.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):f.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):f.reject(t)}static resolve(e){return new f((t,r)=>{t(e)})}static reject(e){return new f((t,r)=>{r(e)})}static waitFor(e){return new f((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=f.resolve(!1);for(const r of e)t=t.next(s=>s?f.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new f((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(e,t){return new f((r,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):r()};i()})}}class us{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new re,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Qn(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const s=Qi(r.target.error);this.P.reject(new Qn(e,s))}}static open(e,t,r,s){try{return new us(t,e.transaction(s,r))}catch(i){throw new Qn(t,i)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(I("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Dm(t)}}class Re{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===Re.D((0,q.z$)())&&ee("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return I("SimpleDb","Removing database:",e),Et(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,q.hl)())return!1;if(Re.N())return!0;const e=(0,q.z$)(),t=Re.D(e),r=0<t&&t<10,s=Re.k(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static N(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,y.Z)(function*(){return t.db||(I("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new Qn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new w(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new w(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Qn(e,a))},i.onupgradeneeded=o=>{I("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.$(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{I("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,y.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.F(e);const u=us.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).next(l=>(u.V(),l)).catch(l=>(u.abort(l),f.reject(l))).toPromise();return c.catch(()=>{}),yield u.v,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(I("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),i.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Cm{constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return Et(this.U.delete())}}class Qn extends w{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function et(n){return"IndexedDbTransactionError"===n.name}class Dm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(I("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Et(r)}add(e){return I("SimpleDb","ADD",this.store.name,e,e),Et(this.store.add(e))}get(e){return Et(this.store.get(e)).next(t=>(void 0===t&&(t=null),I("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return I("SimpleDb","DELETE",this.store.name,e),Et(this.store.delete(e))}count(){return I("SimpleDb","COUNT",this.store.name),Et(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const s=this.cursor(r),i=[];return this.H(s,(o,a)=>{i.push(a)}).next(()=>i)}{const s=this.store.getAll(r.range);return new f((i,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{i(a.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new f((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Y(e,t){I("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}tt(e){const t=this.cursor({});return new f((r,s)=>{t.onerror=i=>{const o=Qi(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new f((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Cm(a),c=t(a.primaryKey,a.value,u);if(c instanceof f){const l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?s():null===u.G?a.continue():a.continue(u.G)}}).next(()=>f.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Et(n){return new f((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=Qi(r.target.error);t(s)}})}let Cc=!1;function Qi(n){const e=Re.D((0,q.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new w("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Cc||(Cc=!0,setTimeout(()=>{throw r},0)),r}}return n}class Am{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;I("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,y.Z)(function*(){t.task=null;try{I("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){et(r)?I("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Je(r)}yield t.nt(6e4)}))}}class Nm{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,y.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let s=t,i=!0;return f.doWhile(()=>!0===i&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return I("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(s,i)).next(a=>(I("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Tc(i);ji(o,r)>0&&(r=o)}),new De(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Te{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>t.writeSequenceNumber(r))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}function Dc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Tt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ac(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}Te.at=-1;class Y{constructor(e,t){this.comparator=e,this.root=t||fe.EMPTY}insert(e,t){return new Y(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,fe.BLACK,null,null))}remove(e){return new Y(this.comparator,this.root.remove(e,this.comparator).copy(null,null,fe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cs(this.root,e,this.comparator,!1)}getReverseIterator(){return new cs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cs(this.root,e,this.comparator,!0)}}class cs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class fe{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??fe.RED,this.left=s??fe.EMPTY,this.right=i??fe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new fe(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return fe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return fe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,fe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,fe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw b();const e=this.left.check();if(e!==this.right.check())throw b();return e+(this.isRed()?0:1)}}fe.EMPTY=null,fe.RED=!0,fe.BLACK=!1,fe.EMPTY=new class{constructor(){this.size=0}get key(){throw b()}get value(){throw b()}get color(){throw b()}get left(){throw b()}get right(){throw b()}copy(n,e,t,r,s){return this}insert(n,e,t){return new fe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class B{constructor(e){this.comparator=e,this.data=new Y(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Nc(this.data.getIterator())}getIteratorFrom(e){return new Nc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof B)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new B(this.comparator);return t.data=e,t}}class Nc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Jt(n){return n.hasNext()?n.getNext():void 0}class Ae{constructor(e){this.fields=e,e.sort(W.comparator)}static empty(){return new Ae([])}unionWith(e){let t=new B(W.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ae(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xt(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class se{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new se(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new se(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return N(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}se.EMPTY_BYTE_STRING=new se("");const Rm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tt(n){if(C(!!n),"string"==typeof n){let e=0;const t=Rm.exec(n);if(C(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:X(n.seconds),nanos:X(n.nanos)}}function X(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function bt(n){return"string"==typeof n?se.fromBase64String(n):se.fromUint8Array(n)}function zi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function kc(n){const e=n.mapValue.fields.__previous_value__;return zi(e)?kc(e):e}function zn(n){const e=tt(n.mapValue.fields.__local_write_time__.timestampValue);return new z(e.seconds,e.nanos)}class Mm{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class nt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new nt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof nt&&e.projectId===this.projectId&&e.database===this.database}}function Zn(n){return null==n}function Hn(n){return 0===n&&1/n==-1/0}function Rc(n){return"number"==typeof n&&Number.isInteger(n)&&!Hn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const rt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ls={nullValue:"NULL_VALUE"};function St(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?zi(n)?4:Oc(n)?9007199254740991:10:b()}function Fe(n,e){if(n===e)return!0;const t=St(n);if(t!==St(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zn(n).isEqual(zn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=tt(r.timestampValue),o=tt(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,bt(n.bytesValue).isEqual(bt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return X(r.geoPointValue.latitude)===X(s.geoPointValue.latitude)&&X(r.geoPointValue.longitude)===X(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return X(r.integerValue)===X(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=X(r.doubleValue),o=X(s.doubleValue);return i===o?Hn(i)===Hn(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Xt(n.arrayValue.values||[],e.arrayValue.values||[],Fe);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(Dc(i)!==Dc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!Fe(i[a],o[a])))return!1;return!0}(n,e);default:return b()}var s}function Wn(n,e){return void 0!==(n.values||[]).find(t=>Fe(t,e))}function st(n,e){if(n===e)return 0;const t=St(n),r=St(e);if(t!==r)return N(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return N(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=X(s.integerValue||s.doubleValue),a=X(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Mc(n.timestampValue,e.timestampValue);case 4:return Mc(zn(n),zn(e));case 5:return N(n.stringValue,e.stringValue);case 6:return function(s,i){const o=bt(s),a=bt(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=N(o[u],a[u]);if(0!==c)return c}return N(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=N(X(s.latitude),X(i.latitude));return 0!==o?o:N(X(s.longitude),X(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=st(o[u],a[u]);if(c)return c}return N(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){if(s===rt.mapValue&&i===rt.mapValue)return 0;if(s===rt.mapValue)return 1;if(i===rt.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let l=0;l<a.length&&l<c.length;++l){const h=N(a[l],c[l]);if(0!==h)return h;const d=st(o[a[l]],u[c[l]]);if(0!==d)return d}return N(a.length,c.length)}(n.mapValue,e.mapValue);default:throw b()}}function Mc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return N(n,e);const t=tt(n),r=tt(e),s=N(t.seconds,r.seconds);return 0!==s?s:N(t.nanos,r.nanos)}function en(n){return Zi(n)}function Zi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=tt(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?bt(n.bytesValue).toBase64():"referenceValue"in n?_.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=Zi(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${Zi(r.fields[a])}`;return i+"}"}(n.mapValue):b();var e}function Ct(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Hi(n){return!!n&&"integerValue"in n}function Yn(n){return!!n&&"arrayValue"in n}function Lc(n){return!!n&&"nullValue"in n}function Fc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function hs(n){return!!n&&"mapValue"in n}function Xn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Tt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Xn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Xn(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Oc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function Lm(n){return"nullValue"in n?ls:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ct(nt.empty(),_.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:b()}function Fm(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ct(nt.empty(),_.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?rt:b()}function Pc(n,e){const t=st(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Vc(n,e){const t=st(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class me{constructor(e){this.value=e}static empty(){return new me({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!hs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xn(t)}setAll(e){let t=W.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Xn(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());hs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];hs(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Tt(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new me(Xn(this.value))}}function Uc(n){const e=[];return Tt(n.fields,(t,r)=>{const s=new W([t]);if(hs(r)){const i=Uc(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ae(e)}class K{constructor(e,t,r,s,i,o){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new K(e,0,D.min(),D.min(),me.empty(),0)}static newFoundDocument(e,t,r){return new K(e,1,t,D.min(),r,0)}static newNoDocument(e,t){return new K(e,2,t,D.min(),me.empty(),0)}static newUnknownDocument(e,t){return new K(e,3,t,D.min(),me.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=me.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=me.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=D.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof K&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new K(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Om{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ht=null}}function Bc(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Om(n,e,t,r,s,i,o)}function Dt(n){const e=x(n);if(null===e.ht){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>{return(s=r).field.canonicalString()+s.op.toString()+en(s.value);var s}).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Zn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>en(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>en(r)).join(",")),e.ht=t}return e.ht}function Jn(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!$m(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!Fe(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$c(n.startAt,e.startAt)&&$c(n.endAt,e.endAt)}function ds(n){return _.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function fs(n,e){return n.filters.filter(t=>t instanceof ge&&t.field.isEqual(e))}function qc(n,e,t){let r=ls,s=!0;for(const i of fs(n,e)){let o=ls,a=!0;switch(i.op){case"<":case"<=":o=Lm(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=ls}Pc({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Pc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}function Gc(n,e,t){let r=rt,s=!0;for(const i of fs(n,e)){let o=rt,a=!0;switch(i.op){case">=":case">":o=Fm(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=rt}Vc({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Vc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}class ge extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,r):new Vm(e,t,r):"array-contains"===t?new qm(e,r):"in"===t?new Gm(e,r):"not-in"===t?new Km(e,r):"array-contains-any"===t?new jm(e,r):new ge(e,t,r)}static lt(e,t,r){return"in"===t?new Um(e,r):new Bm(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.ft(st(t,this.value)):null!==t&&St(this.value)===St(t)&&this.ft(st(t,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return b()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Vm extends ge{constructor(e,t,r){super(e,t,r),this.key=_.fromName(r.referenceValue)}matches(e){const t=_.comparator(e.key,this.key);return this.ft(t)}}class Um extends ge{constructor(e,t){super(e,"in",t),this.keys=Kc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Bm extends ge{constructor(e,t){super(e,"not-in",t),this.keys=Kc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Kc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>_.fromName(r.referenceValue))}class qm extends ge{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Yn(t)&&Wn(t.arrayValue,this.value)}}class Gm extends ge{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Wn(this.value.arrayValue,t)}}class Km extends ge{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Wn(this.value.arrayValue,t)}}class jm extends ge{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Yn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Wn(this.value.arrayValue,r))}}class it{constructor(e,t){this.position=e,this.inclusive=t}}class tn{constructor(e,t="asc"){this.field=e,this.dir=t}}function $m(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function jc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?_.comparator(_.fromName(o.referenceValue),t.key):st(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function $c(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Fe(n.position[t],e.position[t]))return!1;return!0}class je{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this._t=null,this.wt=null}}function Qc(n,e,t,r,s,i,o,a){return new je(n,e,t,r,s,i,o,a)}function nn(n){return new je(n)}function zc(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Wi(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Yi(n){for(const e of n.filters)if(e.dt())return e.field;return null}function Xi(n){return null!==n.collectionGroup}function rn(n){const e=x(n);if(null===e._t){e._t=[];const t=Yi(e),r=Wi(e);if(null!==t&&null===r)t.isKeyField()||e._t.push(new tn(t)),e._t.push(new tn(W.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e._t.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new tn(W.keyField(),i))}}}return e._t}function Ie(n){const e=x(n);if(!e.wt)if("F"===e.limitType)e.wt=Bc(e.path,e.collectionGroup,rn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of rn(e))t.push(new tn(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new it(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new it(e.startAt.position,e.startAt.inclusive):null;e.wt=Bc(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.wt}function ms(n,e,t){return new je(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function er(n,e){return Jn(Ie(n),Ie(e))&&n.limitType===e.limitType}function Zc(n){return`${Dt(Ie(n))}|lt:${n.limitType}`}function Ji(n){return`Query(target=${function Pm(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${en(r.value)}`;var r}).join(", ")}]`),Zn(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>en(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>en(t)).join(",")),`Target(${e})`}(Ie(n))}; limitType=${n.limitType})`}function eo(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):_.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(s,i,o){const a=jc(s,i,o);return s.inclusive?a<=0:a<0}(t.startAt,rn(t),r)||t.endAt&&!function(s,i,o){const a=jc(s,i,o);return s.inclusive?a>=0:a>0}(t.endAt,rn(t),r)));var t,r}function Hc(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Wc(n){return(e,t)=>{let r=!1;for(const s of rn(n)){const i=Qm(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function Qm(n,e,t){const r=n.field.isKeyField()?_.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?st(a,u):b()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return b()}}function Yc(n,e){if(n.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Hn(e)?"-0":e}}function Xc(n){return{integerValue:""+n}}function Jc(n,e){return Rc(e)?Xc(e):Yc(n,e)}class gs{constructor(){this._=void 0}}function zm(n,e,t){return n instanceof sn?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof At?tl(n,e):n instanceof Nt?nl(n,e):function(r,s){const i=el(r,s),o=rl(i)+rl(r.yt);return Hi(i)&&Hi(r.yt)?Xc(o):Yc(r.It,o)}(n,e)}function Zm(n,e,t){return n instanceof At?tl(n,e):n instanceof Nt?nl(n,e):t}function el(n,e){return n instanceof on?Hi(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class sn extends gs{}class At extends gs{constructor(e){super(),this.elements=e}}function tl(n,e){const t=sl(e);for(const r of n.elements)t.some(s=>Fe(s,r))||t.push(r);return{arrayValue:{values:t}}}class Nt extends gs{constructor(e){super(),this.elements=e}}function nl(n,e){let t=sl(e);for(const r of n.elements)t=t.filter(s=>!Fe(s,r));return{arrayValue:{values:t}}}class on extends gs{constructor(e,t){super(),this.It=e,this.yt=t}}function rl(n){return X(n.integerValue||n.doubleValue)}function sl(n){return Yn(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class tr{constructor(e,t){this.field=e,this.transform=t}}class Wm{constructor(e,t){this.version=e,this.transformResults=t}}class Z{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Z}static exists(e){return new Z(void 0,e)}static updateTime(e){return new Z(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ps(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class ys{}function il(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new un(n.key,Z.none()):new an(n.key,n.data,Z.none());{const t=n.data,r=me.empty();let s=new B(W.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?r.delete(i):r.set(i,o),s=s.add(i)}return new $e(n.key,r,new Ae(s.toArray()),Z.none())}}function Ym(n,e,t){n instanceof an?function(r,s,i){const o=r.value.clone(),a=ul(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof $e?function(r,s,i){if(!ps(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=ul(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(al(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function nr(n,e,t,r){return n instanceof an?function(s,i,o,a){if(!ps(s.precondition,i))return o;const u=s.value.clone(),c=cl(s.fieldTransforms,a,i);return u.setAll(c),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof $e?function(s,i,o,a){if(!ps(s.precondition,i))return o;const u=cl(s.fieldTransforms,a,i),c=i.data;return c.setAll(al(s)),c.setAll(u),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),null===o?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(l=>l.field))}(n,e,t,r):(o=t,ps(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function Xm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=el(r.transform,s||null);null!=i&&(null===t&&(t=me.empty()),t.set(r.field,i))}return t||null}function ol(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Xt(t,r,(s,i)=>function Hm(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof At&&r instanceof At||t instanceof Nt&&r instanceof Nt?Xt(t.elements,r.elements,Fe):t instanceof on&&r instanceof on?Fe(t.yt,r.yt):t instanceof sn&&r instanceof sn);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class an extends ys{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class $e extends ys{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function al(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function ul(n,e,t){const r=new Map;C(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Zm(o,a,t[s]))}return r}function cl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,zm(i,o,e))}return r}class un extends ys{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class to extends ys{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jm{constructor(e){this.count=e}}var ne,F;function ll(n){switch(n){default:return b();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function hl(n){if(void 0===n)return ee("GRPC error has no .code"),m.UNKNOWN;switch(n){case ne.OK:return m.OK;case ne.CANCELLED:return m.CANCELLED;case ne.UNKNOWN:return m.UNKNOWN;case ne.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ne.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ne.INTERNAL:return m.INTERNAL;case ne.UNAVAILABLE:return m.UNAVAILABLE;case ne.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ne.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ne.NOT_FOUND:return m.NOT_FOUND;case ne.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ne.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ne.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ne.ABORTED:return m.ABORTED;case ne.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ne.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ne.DATA_LOSS:return m.DATA_LOSS;default:return b()}}(F=ne||(ne={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";class ot{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0===s)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Tt(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ac(this.inner)}size(){return this.innerSize}}const eg=new Y(_.comparator);function be(){return eg}const dl=new Y(_.comparator);function rr(...n){let e=dl;for(const t of n)e=e.insert(t.key,t);return e}function fl(n){let e=dl;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Oe(){return sr()}function ml(){return sr()}function sr(){return new ot(n=>n.toString(),(n,e)=>n.isEqual(e))}const tg=new Y(_.comparator),ng=new B(_.comparator);function k(...n){let e=ng;for(const t of n)e=e.add(t);return e}const rg=new B(N);function vs(){return rg}class ir{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,or.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ir(D.min(),s,vs(),be(),k())}}class or{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new or(r,t,k(),k(),k())}}class ws{constructor(e,t,r,s){this.Tt=e,this.removedTargetIds=t,this.key=r,this.Et=s}}class gl{constructor(e,t){this.targetId=e,this.At=t}}class pl{constructor(e,t,r=se.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class yl{constructor(){this.Rt=0,this.bt=wl(),this.Pt=se.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=k(),t=k(),r=k();return this.bt.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:b()}}),new or(this.Pt,this.vt,e,t,r)}Nt(){this.Vt=!1,this.bt=wl()}kt(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class sg{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=be(),this.qt=vl(),this.Kt=new B(N)}Gt(e){for(const t of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(t,e.Et):this.jt(t,e.key,e.Et);for(const t of e.removedTargetIds)this.jt(t,e.key,e.Et)}Wt(e){this.forEachTarget(e,t=>{const r=this.zt(t);switch(e.state){case 0:this.Ht(t)&&r.Ct(e.resumeToken);break;case 1:r.Ft(),r.St||r.Nt(),r.Ct(e.resumeToken);break;case 2:r.Ft(),r.St||this.removeTarget(t);break;case 3:this.Ht(t)&&(r.$t(),r.Ct(e.resumeToken));break;case 4:this.Ht(t)&&(this.Jt(t),r.Ct(e.resumeToken));break;default:b()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Lt.forEach((r,s)=>{this.Ht(s)&&t(s)})}Yt(e){const t=e.targetId,r=e.At.count,s=this.Xt(t);if(s){const i=s.target;if(ds(i))if(0===r){const o=new _(i.path);this.jt(t,o,K.newNoDocument(o,D.min()))}else C(1===r);else this.Zt(t)!==r&&(this.Jt(t),this.Kt=this.Kt.add(t))}}te(e){const t=new Map;this.Lt.forEach((i,o)=>{const a=this.Xt(o);if(a){if(i.current&&ds(a.target)){const u=new _(a.target.path);null!==this.Ut.get(u)||this.ee(o,u)||this.jt(o,u,K.newNoDocument(u,e))}i.Dt&&(t.set(o,i.xt()),i.Nt())}});let r=k();this.qt.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Xt(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))}),this.Ut.forEach((i,o)=>o.setReadTime(e));const s=new ir(e,t,this.Kt,this.Ut,r);return this.Ut=be(),this.qt=vl(),this.Kt=new B(N),s}Qt(e,t){if(!this.Ht(e))return;const r=this.ee(e,t.key)?2:0;this.zt(e).kt(t.key,r),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e))}jt(e,t,r){if(!this.Ht(e))return;const s=this.zt(e);this.ee(e,t)?s.kt(t,1):s.Ot(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),r&&(this.Ut=this.Ut.insert(t,r))}removeTarget(e){this.Lt.delete(e)}Zt(e){const t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let t=this.Lt.get(e);return t||(t=new yl,this.Lt.set(e,t)),t}ne(e){let t=this.qt.get(e);return t||(t=new B(N),this.qt=this.qt.insert(e,t)),t}Ht(e){const t=null!==this.Xt(e);return t||I("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){const t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new yl),this.Bt.getRemoteKeysForTarget(e).forEach(t=>{this.jt(e,t,null)})}ee(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}function vl(){return new Y(_.comparator)}function wl(){return new Y(_.comparator)}const ig={asc:"ASCENDING",desc:"DESCENDING"},og={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ag{constructor(e,t){this.databaseId=e,this.gt=t}}function ar(n,e){return n.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Il(n,e){return n.gt?e.toBase64():e.toUint8Array()}function ug(n,e){return ar(n,e.toTimestamp())}function ue(n){return C(!!n),D.fromTimestamp(function(e){const t=tt(e);return new z(t.seconds,t.nanos)}(n))}function no(n,e){return(t=n,new L(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function _l(n){const e=L.fromString(n);return C(Al(e)),e}function ur(n,e){return no(n.databaseId,e.path)}function Pe(n,e){const t=_l(e);if(t.get(1)!==n.databaseId.projectId)throw new w(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new w(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new _(El(t))}function ro(n,e){return no(n.databaseId,e)}function xl(n){const e=_l(n);return 4===e.length?L.emptyPath():El(e)}function cr(n){return new L(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function El(n){return C(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Tl(n,e,t){return{name:ur(n,e),fields:t.value.mapValue.fields}}function bl(n,e,t){const r=Pe(n,e.name),s=ue(e.updateTime),i=new me({mapValue:{fields:e.fields}}),o=K.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function lr(n,e){let t;if(e instanceof an)t={update:Tl(n,e.key,e.value)};else if(e instanceof un)t={delete:ur(n,e.key)};else if(e instanceof $e)t={update:Tl(n,e.key,e.data),updateMask:yg(e.fieldMask)};else{if(!(e instanceof to))return b();t={verify:ur(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof sn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof At)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Nt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof on)return{fieldPath:i.field.canonicalString(),increment:o.yt};throw b()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:ug(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:b()),t;var s}function so(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Z.updateTime(ue(s.updateTime)):void 0!==s.exists?Z.exists(s.exists):Z.none():Z.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(C("REQUEST_TIME"===o.setToServerValue),a=new sn):"appendMissingElements"in o?a=new At(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new Nt(o.removeAllFromArray.values||[]):"increment"in o?a=new on(i,o.increment):b();const u=W.fromServerFormat(o.fieldPath);return new tr(u,a)}(n,s)):[];var s;if(e.update){const s=Pe(n,e.update.name),i=new me({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ae((e.updateMask.fieldPaths||[]).map(c=>W.fromServerFormat(c)));return new $e(s,i,o,t,r)}return new an(s,i,t,r)}if(e.delete){const s=Pe(n,e.delete);return new un(s,t)}if(e.verify){const s=Pe(n,e.verify);return new to(s,t)}return b()}function Sl(n,e){return{documents:[ro(n,e.path)]}}function io(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=ro(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=ro(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(u){if(0===u.length)return;const c=u.map(l=>function(h){if("=="===h.op){if(Fc(h.value))return{unaryFilter:{field:cn(h.field),op:"IS_NAN"}};if(Lc(h.value))return{unaryFilter:{field:cn(h.field),op:"IS_NULL"}}}else if("!="===h.op){if(Fc(h.value))return{unaryFilter:{field:cn(h.field),op:"IS_NOT_NAN"}};if(Lc(h.value))return{unaryFilter:{field:cn(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cn(h.field),op:mg(h.op),value:h.value}}}(l));return 1===c.length?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(u){if(0!==u.length)return u.map(c=>{return{field:cn((l=c).field),direction:fg(l.dir)};var l})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(c=e.limit,n.gt||Zn(c)?c:{value:c});var c,a,u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(u=e.endAt).inclusive,values:u.position}),t}function Cl(n){let e=xl(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){C(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=Dl(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new tn(ln((h=l).field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction));var h}));let a=null;t.limit&&(a=function(l){let h;return h="object"==typeof l?l.value:l,Zn(h)?null:h}(t.limit));let u=null;var l;t.startAt&&(u=new it((l=t.startAt).values||[],!!l.before));let c=null;return t.endAt&&(c=function(l){return new it(l.values||[],!l.before)}(t.endAt)),Qc(e,s,o,i,a,"F",u,c)}function Dl(n){return n?void 0!==n.unaryFilter?[pg(n)]:void 0!==n.fieldFilter?[gg(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>Dl(e)).reduce((e,t)=>e.concat(t)):b():[]}function fg(n){return ig[n]}function mg(n){return og[n]}function cn(n){return{fieldPath:n.canonicalString()}}function ln(n){return W.fromServerFormat(n.fieldPath)}function gg(n){return ge.create(ln(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return b()}}(n.fieldFilter.op),n.fieldFilter.value)}function pg(n){switch(n.unaryFilter.op){case"IS_NAN":const e=ln(n.unaryFilter.field);return ge.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=ln(n.unaryFilter.field);return ge.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ln(n.unaryFilter.field);return ge.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ln(n.unaryFilter.field);return ge.create(s,"!=",{nullValue:"NULL_VALUE"});default:return b()}}function yg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Al(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function _e(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Nl(e)),e=vg(n.get(t),e);return Nl(e)}function vg(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function Nl(n){return n+"\x01\x01"}function Ve(n){const e=n.length;if(C(e>=2),2===e)return C("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),L.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&b(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:b()}i=o+2}return new L(r)}const kl=["userId","batchId"];function Is(n,e){return[n,_e(e)]}function Rl(n,e,t){return[n,_e(e),t]}const wg={},Ig=["prefixPath","collectionGroup","readTime","documentId"],_g=["prefixPath","collectionGroup","documentId"],xg=["collectionGroup","readTime","prefixPath","documentId"],Eg=["canonicalId","targetId"],Tg=["targetId","path"],bg=["path","targetId"],Sg=["collectionId","parent"],Cg=["indexId","uid"],Dg=["uid","sequenceNumber"],Ag=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ng=["indexId","uid","orderedDocumentKey"],kg=["userId","collectionPath","documentId"],Rg=["userId","collectionPath","largestBatchId"],Mg=["userId","collectionGroup","largestBatchId"],Ml=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Lg=[...Ml,"documentOverlays"],Ll=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Fl=Ll,Fg=[...Fl,"indexConfiguration","indexState","indexEntries"];class oo extends Sc{constructor(e,t){super(),this.ie=e,this.currentSequenceNumber=t}}function ce(n,e){const t=x(n);return Re.M(t.ie,e)}class ao{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Ym(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=nr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=nr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ml();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=il(o,a);null!==u&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(D.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),k())}isEqual(e){return this.batchId===e.batchId&&Xt(this.mutations,e.mutations,(t,r)=>ol(t,r))&&Xt(this.baseMutations,e.baseMutations,(t,r)=>ol(t,r))}}class uo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){C(e.mutations.length===r.length);let s=tg;const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new uo(e,t,r,s)}}class co{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class at{constructor(e,t,r,s,i=D.min(),o=D.min(),a=se.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new at(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ol{constructor(e){this.re=e}}function Pl(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_s(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:ur(s=n.re,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:ar(s,i.version.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:kt(e.version)};else{if(!e.isUnknownDocument())return b();r.unknownDocument={path:t.path.toArray(),version:kt(e.version)}}var s,i;return r}function _s(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function kt(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Rt(n){const e=new z(n.seconds,n.nanoseconds);return D.fromTimestamp(e)}function Mt(n,e){const t=(e.baseMutations||[]).map(i=>so(n.re,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>so(n.re,i)),s=z.fromMillis(e.localWriteTimeMs);return new ao(e.batchId,s,t,r)}function hr(n){const e=Rt(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Rt(n.lastLimboFreeSnapshotVersion):D.min();let r;var s;return void 0!==n.query.documents?(C(1===(s=n.query).documents.length),r=Ie(nn(xl(s.documents[0])))):r=Ie(Cl(n.query)),new at(r,n.targetId,0,n.lastListenSequenceNumber,e,t,se.fromBase64String(n.resumeToken))}function Vl(n,e){const t=kt(e.snapshotVersion),r=kt(e.lastLimboFreeSnapshotVersion);let s;s=ds(e.target)?Sl(n.re,e.target):io(n.re,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Dt(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function lo(n){const e=Cl({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?ms(e,e.limit,"L"):e}function ho(n,e){return new co(e.largestBatchId,so(n.re,e.overlayMutation))}function Ul(n,e){const t=e.path.lastSegment();return[n,_e(e.path.popLast()),t]}function Bl(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:kt(r.readTime),documentKey:_e(r.documentKey.path),largestBatchId:r.largestBatchId}}class Pg{getBundleMetadata(e,t){return ql(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Rt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return ql(e).put({bundleId:(r=t).id,createTime:kt(ue(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Gl(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:lo(s.bundledQuery),readTime:Rt(s.readTime)};var s})}saveNamedQuery(e,t){return Gl(e).put({name:(r=t).name,readTime:kt(ue(r.readTime)),bundledQuery:r.bundledQuery});var r}}function ql(n){return ce(n,"bundles")}function Gl(n){return ce(n,"namedQueries")}class xs{constructor(e,t){this.It=e,this.userId=t}static oe(e,t){return new xs(e,t.uid||"")}getOverlay(e,t){return dr(e).get(Ul(this.userId,t)).next(r=>r?ho(this.It,r):null)}getOverlays(e,t){const r=Oe();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new co(t,o);s.push(this.ue(e,a))}),f.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(_e(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(dr(e).Y("collectionPathOverlayIndex",a))}),f.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Oe(),i=_e(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return dr(e).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=ho(this.It,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Oe();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return dr(e).Z({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=ho(this.It,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>i)}ue(e,t){return dr(e).put(function(r,s,i){const[o,a,u]=Ul(s,i.mutation.key);return{userId:s,collectionPath:a,documentId:u,collectionGroup:i.mutation.key.getCollectionGroup(),largestBatchId:i.largestBatchId,overlayMutation:lr(r.re,i.mutation)}}(this.It,this.userId,t))}}function dr(n){return ce(n,"documentOverlays")}class Lt{constructor(){}ce(e,t){this.ae(e,t),t.he()}ae(e,t){if("nullValue"in e)this.le(t,5);else if("booleanValue"in e)this.le(t,10),t.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(t,15),t.fe(X(e.integerValue));else if("doubleValue"in e){const r=X(e.doubleValue);isNaN(r)?this.le(t,13):(this.le(t,15),Hn(r)?t.fe(0):t.fe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.le(t,20),"string"==typeof r?t.de(r):(t.de(`${r.seconds||""}`),t.fe(r.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,t),this.we(t);else if("bytesValue"in e)this.le(t,30),t.me(bt(e.bytesValue)),this.we(t);else if("referenceValue"in e)this.ge(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.le(t,45),t.fe(r.latitude||0),t.fe(r.longitude||0)}else"mapValue"in e?Oc(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):b()}_e(e,t){this.le(t,25),this.Ie(e,t)}Ie(e,t){t.de(e)}ye(e,t){const r=e.fields||{};this.le(t,55);for(const s of Object.keys(r))this._e(s,t),this.ae(r[s],t)}pe(e,t){const r=e.values||[];this.le(t,50);for(const s of r)this.ae(s,t)}ge(e,t){this.le(t,37),_.fromName(e).path.forEach(r=>{this.le(t,60),this.Ie(r,t)})}le(e,t){e.fe(t)}we(e){e.fe(2)}}function Vg(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function Kl(n){const e=64-function(t){let r=0;for(let s=0;s<8;++s){const i=Vg(255&t[s]);if(r+=i,8!==i)break}return r}(n);return Math.ceil(e/8)}Lt.Te=new Lt;class Ug{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ae(r.value),r=t.next();this.Re()}be(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Pe(r.value),r=t.next();this.ve()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ae(r);else if(r<2048)this.Ae(960|r>>>6),this.Ae(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|r>>>12),this.Ae(128|63&r>>>6),this.Ae(128|63&r);else{const s=t.codePointAt(0);this.Ae(240|s>>>18),this.Ae(128|63&s>>>12),this.Ae(128|63&s>>>6),this.Ae(128|63&s)}}this.Re()}Se(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Pe(r);else if(r<2048)this.Pe(960|r>>>6),this.Pe(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|r>>>12),this.Pe(128|63&r>>>6),this.Pe(128|63&r);else{const s=t.codePointAt(0);this.Pe(240|s>>>18),this.Pe(128|63&s>>>12),this.Pe(128|63&s>>>6),this.Pe(128|63&s)}}this.ve()}De(e){const t=this.Ce(e),r=Kl(t);this.xe(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Ne(e){const t=this.Ce(e),r=Kl(t);this.xe(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const t=function(s){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,s,!1),new Uint8Array(i.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ae(e){const t=255&e;0===t?(this.Oe(0),this.Oe(255)):255===t?(this.Oe(255),this.Oe(0)):this.Oe(t)}Pe(e){const t=255&e;0===t?(this.Fe(0),this.Fe(255)):255===t?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Bg{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class qg{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Me()}}class fr{constructor(){this.Be=new Ug,this.Le=new Bg(this.Be),this.Ue=new qg(this.Be)}seed(e){this.Be.seed(e)}qe(e){return 0===e?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}class Ft{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ft(this.indexId,this.documentKey,this.arrayValue,r)}}function Ot(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=jl(n.arrayValue,e.arrayValue),0!==t?t:(t=jl(n.directionalValue,e.directionalValue),0!==t?t:_.comparator(n.documentKey,e.documentKey)))}function jl(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Gg{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const t of e.filters){const r=t;r.dt()?this.je=r:this.Qe.push(r)}}We(e){const t=Ki(e);if(void 0!==t&&!this.ze(t))return!1;const r=xt(e);let s=0,i=0;for(;s<r.length&&this.ze(r[s]);++s);if(s===r.length)return!0;if(void 0!==this.je){const o=r[s];if(!this.He(this.je,o)||!this.Je(this.Ge[i++],o))return!1;++s}for(;s<r.length;++s){const o=r[s];if(i>=this.Ge.length||!this.Je(this.Ge[i++],o))return!1}return!0}ze(e){for(const t of this.Qe)if(this.He(t,e))return!0;return!1}He(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}Je(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class Kg{constructor(){this.Ye=new fo}addToCollectionParentIndex(e,t){return this.Ye.add(t),f.resolve()}getCollectionParents(e,t){return f.resolve(this.Ye.getEntries(t))}addFieldIndex(e,t){return f.resolve()}deleteFieldIndex(e,t){return f.resolve()}getDocumentsMatchingTarget(e,t){return f.resolve(null)}getIndexType(e,t){return f.resolve(0)}getFieldIndexes(e,t){return f.resolve([])}getNextCollectionGroupToUpdate(e){return f.resolve(null)}getMinOffset(e,t){return f.resolve(De.min())}getMinOffsetFromCollectionGroup(e,t){return f.resolve(De.min())}updateCollectionGroup(e,t,r){return f.resolve()}updateIndexEntries(e,t){return f.resolve()}}class fo{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new B(L.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new B(L.comparator)).toArray()}}const Es=new Uint8Array(0);class jg{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new fo,this.Ze=new ot(r=>Dt(r),(r,s)=>Jn(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Xe.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});const i={collectionId:r,parent:_e(s)};return $l(e).put(i)}return f.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[xc(t),""],!1,!0);return $l(e).W(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ve(o.parent))}return r})}addFieldIndex(e,t){const r=Ts(e),s={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete s.indexId;const i=r.add(s);if(t.indexState){const o=gr(e);return i.next(a=>{o.put(Bl(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Ts(e),s=gr(e),i=mr(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=mr(e);let s=!0;const i=new Map;return f.forEach(this.tn(t),o=>this.en(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=k();const a=[];return f.forEach(i,(u,c)=>{var l;I("IndexedDbIndexManager",`Using index ${l=u,`id=${l.indexId}|cg=${l.collectionGroup}|f=${l.fields.map(O=>`${O.fieldPath}:${O.kind}`).join(",")}`} to execute ${Dt(t)}`);const h=function(O,J){const V=Ki(J);if(void 0===V)return null;for(const U of fs(O,V.fieldPath))switch(U.op){case"array-contains-any":return U.value.arrayValue.values||[];case"array-contains":return[U.value]}return null}(c,u),d=function(O,J){const V=new Map;for(const U of xt(J))for(const ie of fs(O,U.fieldPath))switch(ie.op){case"==":case"in":V.set(U.fieldPath.canonicalString(),ie.value);break;case"not-in":case"!=":return V.set(U.fieldPath.canonicalString(),ie.value),Array.from(V.values())}return null}(c,u),p=function(O,J){const V=[];let U=!0;for(const ie of xt(J)){const Nr=0===ie.kind?qc(O,ie.fieldPath,O.startAt):Gc(O,ie.fieldPath,O.startAt);V.push(Nr.value),U&&(U=Nr.inclusive)}return new it(V,U)}(c,u),v=function(O,J){const V=[];let U=!0;for(const ie of xt(J)){const Nr=0===ie.kind?Gc(O,ie.fieldPath,O.endAt):qc(O,ie.fieldPath,O.endAt);V.push(Nr.value),U&&(U=Nr.inclusive)}return new it(V,U)}(c,u),E=this.nn(u,c,p),T=this.nn(u,c,v),P=this.sn(u,c,d),G=this.rn(u.indexId,h,E,p.inclusive,T,v.inclusive,P);return f.forEach(G,O=>r.J(O,t.limit).next(J=>{J.forEach(V=>{const U=_.fromSegments(V.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return f.resolve(null)})}tn(e){let t=this.Ze.get(e);return t||(t=[e],this.Ze.set(e,t),t)}rn(e,t,r,s,i,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,i.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.on(t[h/c]):Es,p=this.un(e,d,r[h%c],s),v=this.cn(e,d,i[h%c],o),E=a.map(T=>this.un(e,d,T,!0));l.push(...this.createRange(p,v,E))}return l}un(e,t,r,s){const i=new Ft(e,_.empty(),t,r);return s?i:i.Ke()}cn(e,t,r,s){const i=new Ft(e,_.empty(),t,r);return s?i.Ke():i}en(e,t){const r=new Gg(t),s=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.We(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;return f.forEach(this.tn(t),s=>this.en(e,s).next(i=>{i?0!==r&&i.fields.length<function(o){let a=new B(W.comparator),u=!1;for(const c of o.filters){const l=c;l.field.isKeyField()||("array-contains"===l.op||"array-contains-any"===l.op?u=!0:a=a.add(l.field))}for(const c of o.orderBy)c.field.isKeyField()||(a=a.add(c.field));return a.size+(u?1:0)}(s)&&(r=1):r=0})).next(()=>r)}an(e,t){const r=new fr;for(const s of xt(e)){const i=t.data.field(s.fieldPath);if(null==i)return null;const o=r.qe(s.kind);Lt.Te.ce(i,o)}return r.$e()}on(e){const t=new fr;return Lt.Te.ce(e,t.qe(0)),t.$e()}hn(e,t){const r=new fr;return Lt.Te.ce(Ct(this.databaseId,t),r.qe(function(s){const i=xt(s);return 0===i.length?0:i[i.length-1].kind}(e))),r.$e()}sn(e,t,r){if(null===r)return[];let s=[];s.push(new fr);let i=0;for(const o of xt(e)){const a=r[i++];for(const u of s)if(this.ln(t,o.fieldPath)&&Yn(a))s=this.fn(s,o,a);else{const c=u.qe(o.kind);Lt.Te.ce(a,c)}}return this.dn(s)}nn(e,t,r){return this.sn(e,t,r.position)}dn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].$e();return t}fn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new fr;u.seed(a.$e()),Lt.Te.ce(o,u.qe(t.kind)),i.push(u)}return i}ln(e,t){return!!e.filters.find(r=>r instanceof ge&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Ts(e),s=gr(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(i=>{const o=[];return f.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(c,l){const h=l?new $n(l.sequenceNumber,new De(Rt(l.readTime),new _(Ve(l.documentKey)),l.largestBatchId)):$n.empty(),d=c.fields.map(([p,v])=>new as(W.fromServerFormat(p),v));return new os(c.indexId,c.collectionGroup,d,h)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return 0!==i?i:N(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Ts(e),i=gr(e);return this._n(e).next(o=>s.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>f.forEach(a,u=>i.put(Bl(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return f.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),f.forEach(a,u=>this.wn(e,s,u).next(c=>{const l=this.mn(i,u);return c.isEqual(l)?f.resolve():this.gn(e,i,u,c,l)}))))})}yn(e,t,r,s){return mr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.hn(r,t.key),documentKey:t.key.path.toArray()})}pn(e,t,r,s){return mr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.hn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=mr(e);let i=new B(Ot);return s.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.hn(r,t)])},(o,a)=>{i=i.add(new Ft(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}mn(e,t){let r=new B(Ot);const s=this.an(t,e);if(null==s)return r;const i=Ki(t);if(null!=i){const o=e.data.field(i.fieldPath);if(Yn(o))for(const a of o.arrayValue.values||[])r=r.add(new Ft(t.indexId,e.key,this.on(a),s))}else r=r.add(new Ft(t.indexId,e.key,Es,s));return r}gn(e,t,r,s,i){I("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,u,c,l,h){const d=a.getIterator(),p=u.getIterator();let v=Jt(d),E=Jt(p);for(;v||E;){let T=!1,P=!1;if(v&&E){const G=c(v,E);G<0?P=!0:G>0&&(T=!0)}else null!=v?P=!0:T=!0;T?(l(E),E=Jt(p)):P?(h(v),v=Jt(d)):(v=Jt(d),E=Jt(p))}}(s,i,Ot,a=>{o.push(this.yn(e,t,r,a))},a=>{o.push(this.pn(e,t,r,a))}),f.waitFor(o)}_n(e){let t=1;return gr(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ot(o,a)).filter((o,a,u)=>!a||0!==Ot(o,u[a-1]));const s=[];s.push(e);for(const o of r){const a=Ot(o,e),u=Ot(o,t);if(0===a)s[0]=e.Ke();else if(a>0&&u<0)s.push(o),s.push(o.Ke());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2)i.push(IDBKeyRange.bound([s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Es,[]],[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Es,[]]));return i}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ql)}getMinOffset(e,t){return f.mapArray(this.tn(t),r=>this.en(e,r).next(s=>s||b())).next(Ql)}}function $l(n){return ce(n,"collectionParents")}function mr(n){return ce(n,"indexEntries")}function Ts(n){return ce(n,"indexConfiguration")}function gr(n){return ce(n,"indexState")}function Ql(n){C(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;ji(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new De(e.readTime,e.documentKey,t)}const zl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Se{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Se(e,Se.DEFAULT_COLLECTION_PERCENTILE,Se.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Zl(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Z({range:o},(l,h,d)=>(a++,d.delete()));i.push(u.next(()=>{C(1===a)}));const c=[];for(const l of t.mutations){const h=Rl(e,l.key.path,t.batchId);i.push(s.delete(h)),c.push(l.key)}return f.waitFor(i).next(()=>c)}function bs(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw b();e=n.noDocument}return JSON.stringify(e).length}Se.DEFAULT_COLLECTION_PERCENTILE=10,Se.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Se.DEFAULT=new Se(41943040,Se.DEFAULT_COLLECTION_PERCENTILE,Se.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Se.DISABLED=new Se(-1,0,0);class Ss{constructor(e,t,r,s){this.userId=e,this.It=t,this.indexManager=r,this.referenceDelegate=s,this.In={}}static oe(e,t,r,s){C(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ss(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).Z({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=hn(e),o=ut(e);return o.add({}).next(a=>{C("number"==typeof a);const u=new ao(a,t,r,s),c=function(d,p,v){const E=v.baseMutations.map(P=>lr(d.re,P)),T=v.mutations.map(P=>lr(d.re,P));return{userId:p,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:E,mutations:T}}(this.It,this.userId,u),l=[];let h=new B((d,p)=>N(d.canonicalString(),p.canonicalString()));for(const d of s){const p=Rl(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(i.put(p,wg))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return ut(e).get(t).next(r=>r?(C(r.userId===this.userId),Mt(this.It,r)):null)}Tn(e,t){return this.In[t]?f.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.In[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ut(e).Z({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(C(a.batchId>=r),i=Mt(this.It,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ut(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).W("userMutationsIndex",t).next(r=>r.map(s=>Mt(this.It,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Is(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return hn(e).Z({range:s},(o,a,u)=>{const[c,l,h]=o,d=Ve(l);if(c===this.userId&&t.path.isEqual(d))return ut(e).get(h).next(p=>{if(!p)throw b();C(p.userId===this.userId),i.push(Mt(this.It,p))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new B(N);const s=[];return t.forEach(i=>{const o=Is(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=hn(e).Z({range:a},(c,l,h)=>{const[d,p,v]=c,E=Ve(p);d===this.userId&&i.path.isEqual(E)?r=r.add(v):h.done()});s.push(u)}),f.waitFor(s).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Is(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new B(N);return hn(e).Z({range:o},(u,c,l)=>{const[h,d,p]=u,v=Ve(d);h===this.userId&&r.isPrefixOf(v)?v.length===s&&(a=a.add(p)):l.done()}).next(()=>this.En(e,a))}En(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ut(e).get(i).next(o=>{if(null===o)throw b();C(o.userId===this.userId),r.push(Mt(this.It,o))}))}),f.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Zl(e.ie,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),f.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return f.resolve();const r=IDBKeyRange.lowerBound([this.userId]),s=[];return hn(e).Z({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Ve(i[1]);s.push(u)}else a.done()}).next(()=>{C(0===s.length)})})}containsKey(e,t){return Hl(e,this.userId,t)}Rn(e){return Wl(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Hl(n,e,t){const r=Is(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return hn(n).Z({range:i,X:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function ut(n){return ce(n,"mutations")}function hn(n){return ce(n,"documentMutations")}function Wl(n){return ce(n,"mutationQueues")}class Pt{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Pt(0)}static vn(){return new Pt(-1)}}class $g{constructor(e,t){this.referenceDelegate=e,this.It=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Pt(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>D.fromTimestamp(new z(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Sn(e,s)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dn(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(C(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return dn(e).Z((o,a)=>{const u=hr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>f.waitFor(i)).next(()=>s)}forEachTarget(e,t){return dn(e).Z((r,s)=>{const i=hr(s);t(i)})}Vn(e){return Yl(e).get("targetGlobalKey").next(t=>(C(null!==t),t))}Sn(e,t){return Yl(e).put("targetGlobalKey",t)}Dn(e,t){return dn(e).put(Vl(this.It,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Dt(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return dn(e).Z({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=hr(a);Jn(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ct(e);return t.forEach(o=>{const a=_e(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),f.waitFor(s)}removeMatchingKeys(e,t,r){const s=ct(e);return f.forEach(t,i=>{const o=_e(i.path);return f.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ct(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ct(e);let i=k();return s.Z({range:r,X:!0},(o,a,u)=>{const c=Ve(o[1]),l=new _(c);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=_e(t.path),s=IDBKeyRange.bound([r],[xc(r)],!1,!0);let i=0;return ct(e).Z({index:"documentTargetsIndex",X:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}se(e,t){return dn(e).get(t).next(r=>r?hr(r):null)}}function dn(n){return ce(n,"targets")}function Yl(n){return ce(n,"targetGlobal")}function ct(n){return ce(n,"targetDocuments")}function Xl([n,e],[t,r]){const s=N(n,t);return 0===s?N(e,r):s}class Qg{constructor(e){this.xn=e,this.buffer=new B(Xl),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Xl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,y.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){et(r)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Je(r)}yield t.Fn(3e5)}))}}class Zg{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return f.resolve(Te.at);const r=new Qg(t);return this.$n.forEachTarget(e,s=>r.On(s.sequenceNumber)).next(()=>this.$n.Ln(e,s=>r.On(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(zl)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zl):this.Un(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(e,t){let r,s,i,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),qi()<=pt.in.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}class Hg{constructor(e,t){this.db=e,this.garbageCollector=new Zg(this,t)}Bn(e){const t=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}qn(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,s)=>t(s))}addReference(e,t,r){return Cs(e,r)}removeReference(e,t,r){return Cs(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cs(e,t)}Gn(e,t){return function(r,s){let i=!1;return Wl(r).tt(o=>Hl(r,o,s).next(a=>(a&&(i=!0),f.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Kn(e,(o,a)=>{if(a<=t){const u=this.Gn(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,D.min()),ct(e).delete([0,_e(o.path)])))});s.push(u)}}).next(()=>f.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cs(e,t)}Kn(e,t){const r=ct(e);let s,i=Te.at;return r.Z({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==Te.at&&t(new _(Ve(s)),i),i=c,s=u):i=Te.at}).next(()=>{i!==Te.at&&t(new _(Ve(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cs(n,e){return ct(n).put((r=n.currentSequenceNumber,{targetId:0,path:_e(e.path),sequenceNumber:r}));var r}class Jl{constructor(){this.changes=new ot(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,K.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?f.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Wg{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Vt(e).put(r)}removeEntry(e,t,r){return Vt(e).delete(function(s,i){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],_s(i),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=K.newInvalidDocument(t);return Vt(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(pr(t))},(s,i)=>{r=this.jn(t,i)}).next(()=>r)}Wn(e,t){let r={size:0,document:K.newInvalidDocument(t)};return Vt(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(pr(t))},(s,i)=>{r={document:this.jn(t,i),size:bs(i)}}).next(()=>r)}getEntries(e,t){let r=be();return this.zn(e,t,(s,i)=>{const o=this.jn(s,i);r=r.insert(s,o)}).next(()=>r)}Hn(e,t){let r=be(),s=new Y(_.comparator);return this.zn(e,t,(i,o)=>{const a=this.jn(i,o);r=r.insert(i,a),s=s.insert(i,bs(o))}).next(()=>({documents:r,Jn:s}))}zn(e,t,r){if(t.isEmpty())return f.resolve();let s=new B(rh);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(pr(s.first()),pr(s.last())),o=s.getIterator();let a=o.getNext();return Vt(e).Z({index:"documentKeyIndex",range:i},(u,c,l)=>{const h=_.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&rh(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.j(pr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,t,r){const s=[t.popLast().toArray(),t.lastSegment(),_s(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vt(e).W(IDBKeyRange.bound(s,i,!0)).next(o=>{let a=be();for(const u of o){const c=this.jn(_.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);a=a.insert(c.key,c)}return a})}getAllFromCollectionGroup(e,t,r,s){let i=be();const o=nh(t,r),a=nh(t,De.max());return Vt(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.jn(_.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&l.done()}).next(()=>i)}newChangeBuffer(e){return new Yg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return th(e).get("remoteDocumentGlobalKey").next(t=>(C(!!t),t))}Qn(e,t){return th(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function Og(n,e){let t;if(e.document)t=bl(n.re,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=_.fromSegments(e.noDocument.path),s=Rt(e.noDocument.readTime);t=K.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return b();{const r=_.fromSegments(e.unknownDocument.path),s=Rt(e.unknownDocument.version);t=K.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(r){const s=new z(r[0],r[1]);return D.fromTimestamp(s)}(e.readTime)),t}(this.It,t);if(!r.isNoDocument()||!r.version.isEqual(D.min()))return r}return K.newInvalidDocument(e)}}function eh(n){return new Wg(n)}class Yg extends Jl{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new ot(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new B((i,o)=>N(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=Pl(this.Yn.It,o);s=s.add(i.path.popLast()),r+=bs(u)-a.size,t.push(this.Yn.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=Pl(this.Yn.It,o.convertToNoDocument(D.min()));t.push(this.Yn.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Yn.updateMetadata(e,r)),f.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:s})=>(s.forEach((i,o)=>{this.Xn.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function th(n){return ce(n,"remoteDocumentGlobal")}function Vt(n){return ce(n,"remoteDocumentsV14")}function pr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function nh(n,e){const t=e.documentKey.path.toArray();return[n,_s(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function rh(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=N(t[i],r[i]),s)return s;return s=N(t.length,r.length),s||(s=N(t[t.length-2],r[r.length-2]),s||N(t[t.length-1],r[r.length-1]))}class Xg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sh{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.getBaseDocument(e,t,r))).next(s=>(null!==r&&nr(r.mutation,s,Ae.empty(),z.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,k()).next(()=>r))}getLocalViewOfDocuments(e,t,r=k()){const s=Oe();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=rr();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Oe();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,k()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=be();const o=sr(),a=sr();return t.forEach((u,c)=>{const l=r.get(c.key);s.has(c.key)&&(void 0===l||l.mutation instanceof $e)?i=i.insert(c.key,c):void 0!==l&&(o.set(c.key,l.mutation.getFieldMask()),nr(l.mutation,c,l.mutation.getFieldMask(),z.now()))}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Xg(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=sr();let s=new Y((o,a)=>o-a),i=k();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Ae.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(s.get(a.batchId)||k()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=ml();l.forEach(d=>{if(!i.has(d)){const p=il(t.get(d),r.get(d));null!==p&&h.set(d,p),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return _.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Xi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):f.resolve(Oe());let a=-1,u=i;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?f.resolve():this.getBaseDocument(e,l,h).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,k())).next(l=>({batchId:a,changes:fl(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new _(t)).next(r=>{let s=rr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const s=t.collectionGroup;let i=rr();return this.indexManager.getCollectionParents(e,s).next(o=>f.forEach(o,a=>{const u=(c=t,l=a.child(s),new je(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{i=i.insert(l,h)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r){let s;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(i=>(s=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(i=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,K.newInvalidDocument(c)))});let o=rr();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&nr(c.mutation,u,Ae.empty(),z.now()),eo(t,u)&&(o=o.insert(a,u))}),o})}getBaseDocument(e,t,r){return null===r||1===r.mutation.type?this.remoteDocumentCache.getEntry(e,t):f.resolve(K.newInvalidDocument(t))}}class Jg{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return f.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:ue(r.createTime)}),f.resolve()}getNamedQuery(e,t){return f.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:lo(r.bundledQuery),readTime:ue(r.readTime)}),f.resolve();var r}}class ep{constructor(){this.overlays=new Y(_.comparator),this.es=new Map}getOverlay(e,t){return f.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Oe();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ue(e,t,i)}),f.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.es.get(r);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.es.delete(r)),f.resolve()}getOverlaysForCollection(e,t,r){const s=Oe(),i=t.length+1,o=new _(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return f.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Y((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=i.get(c.largestBatchId);null===l&&(l=Oe(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Oe(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return f.resolve(a)}ue(e,t,r){const s=this.overlays.get(r.key);if(null!==s){const o=this.es.get(s.largestBatchId).delete(r.key);this.es.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new co(t,r));let i=this.es.get(t);void 0===i&&(i=k(),this.es.set(t,i)),this.es.set(t,i.add(r.key))}}class mo{constructor(){this.ns=new B(le.ss),this.rs=new B(le.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new le(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new le(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new _(new L([])),r=new le(t,e),s=new le(t,e+1),i=[];return this.rs.forEachInRange([r,s],o=>{this.cs(o),i.push(o.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new _(new L([])),r=new le(t,e),s=new le(t,e+1);let i=k();return this.rs.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new le(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class le{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return _.comparator(e.key,t.key)||N(e._s,t._s)}static os(e,t){return N(e._s,t._s)||_.comparator(e.key,t.key)}}class tp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new B(le.ss)}checkEmpty(e){return f.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,s){const i=this.ws;this.ws++;const o=new ao(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.gs=this.gs.add(new le(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(e,t){return f.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.ps(t+1),i=s<0?0:s;return f.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new le(t,0),s=new le(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([r,s],o=>{const a=this.ys(o._s);i.push(a)}),f.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new B(N);return t.forEach(s=>{const i=new le(s,0),o=new le(s,Number.POSITIVE_INFINITY);this.gs.forEachInRange([i,o],a=>{r=r.add(a._s)})}),f.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;_.isDocumentKey(i)||(i=i.child(""));const o=new le(new _(i),0);let a=new B(N);return this.gs.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u._s)),!0)},o),f.resolve(this.Is(a))}Is(e){const t=[];return e.forEach(r=>{const s=this.ys(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){C(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return f.forEach(t.mutations,s=>{const i=new le(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new le(t,0),s=this.gs.firstAfterOrEqual(r);return f.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return f.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class np{constructor(e){this.Es=e,this.docs=new Y(_.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return f.resolve(r?r.document.mutableCopy():K.newInvalidDocument(t))}getEntries(e,t){let r=be();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():K.newInvalidDocument(s))}),f.resolve(r)}getAllFromCollection(e,t,r){let s=be();const i=new _(t.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||ji(Tc(u),r)<=0||(s=s.insert(u.key,u.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(e,t,r,s){b()}As(e,t){return f.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new rp(this)}getSize(e){return f.resolve(this.size)}}class rp extends Jl{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Yn.addEntry(e,s)):this.Yn.removeEntry(r)}),f.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class sp{constructor(e){this.persistence=e,this.Rs=new ot(t=>Dt(t),Jn),this.lastRemoteSnapshotVersion=D.min(),this.highestTargetId=0,this.bs=0,this.Ps=new mo,this.targetCount=0,this.vs=Pt.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,s)=>t(s)),f.resolve()}getLastRemoteSnapshotVersion(e){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return f.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),f.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Pt(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,f.resolve()}updateTargetData(e,t){return this.Dn(t),f.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,f.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Rs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),f.waitFor(i).next(()=>s)}getTargetCount(e){return f.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return f.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),f.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),f.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),f.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return f.resolve(r)}containsKey(e,t){return f.resolve(this.Ps.containsKey(t))}}class ih{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new Te(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new sp(this),this.indexManager=new Kg,this.remoteDocumentCache=new np(r=>this.referenceDelegate.xs(r)),this.It=new Ol(t),this.Ns=new Jg(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ep,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new tp(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){I("MemoryPersistence","Starting transaction:",e);const s=new ip(this.Ss.next());return this.referenceDelegate.ks(),r(s).next(i=>this.referenceDelegate.Os(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ms(e,t){return f.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class ip extends Sc{constructor(e){super(),this.currentSequenceNumber=e}}class Ds{constructor(e){this.persistence=e,this.Fs=new mo,this.$s=null}static Bs(e){return new Ds(e)}get Ls(){if(this.$s)return this.$s;throw b()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),f.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),f.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),f.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(s=>this.Ls.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Ls.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Ls,r=>{const s=_.fromPath(r);return this.Us(e,s).next(i=>{i||t.removeEntry(s,D.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.Us(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}Us(e,t){return f.or([()=>f.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class op{constructor(e){this.It=e}$(e,t,r,s){const i=new us("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kl,{unique:!0}),a.createObjectStore("documentMutations"),oh(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=f.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),oh(e)),o=o.next(()=>function(a){const u=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:D.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store("mutations").W().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kl,{unique:!0});const l=u.store("mutations"),h=c.map(d=>l.put(d));return f.waitFor(h)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.qs(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(i)))),r<7&&s>=7&&(o=o.next(()=>this.Gs(i))),r<8&&s>=8&&(o=o.next(()=>this.Qs(e,i))),r<9&&s>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&s>=10&&(o=o.next(()=>this.js(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{!function(a){const u=a.createObjectStore("documentOverlays",{keyPath:kg});u.createIndex("collectionPathOverlayIndex",Rg,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",Mg,{unique:!1})}(e)})),r<13&&s>=13&&(o=o.next(()=>function(a){const u=a.createObjectStore("remoteDocumentsV14",{keyPath:Ig});u.createIndex("documentKeyIndex",_g),u.createIndex("collectionGroupIndex",xg)}(e)).next(()=>this.Ws(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.zs(e,i))),r<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:Cg}).createIndex("sequenceNumberIndex",Dg,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:Ag}).createIndex("documentKeyIndex",Ng,{unique:!1})}(e))),o}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,s)=>{t+=bs(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}qs(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(s=>f.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>f.forEach(a,u=>{C(u.userId===i.userId);const c=Mt(this.It,u);return Zl(e,i.userId,c).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.Z((o,a)=>{const u=new L(o),c=[0,_e(u)];i.push(t.get(c).next(l=>l?f.resolve():t.put({targetId:0,path:_e(u),sequenceNumber:s.highestListenSequenceNumber})))}).next(()=>f.waitFor(i))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:Sg});const r=t.store("collectionParents"),s=new fo,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:_e(u)})}};return t.store("remoteDocuments").Z({X:!0},(o,a)=>{const u=new L(o);return i(u.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([o,a,u],c)=>{const l=Ve(a);return i(l.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,s)=>{const i=hr(s),o=Vl(this.It,i);return t.put(o)})}Ws(e,t){const r=t.store("remoteDocuments"),s=[];return r.Z((i,o)=>{const a=t.store("remoteDocumentsV14"),u=(c=o,c.document?new _(L.fromString(c.document.name).popFirst(5)):c.noDocument?_.fromSegments(c.noDocument.path):c.unknownDocument?_.fromSegments(c.unknownDocument.path):b()).path.toArray();var c;const l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(l))}).next(()=>f.waitFor(s))}zs(e,t){const r=t.store("mutations"),s=eh(this.It),i=new ih(Ds.Bs,this.It.re);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:k();Mt(this.It,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{const l=new ae(c),h=xs.oe(this.It,l),d=i.getIndexManager(l),p=Ss.oe(l,this.It,d,i.referenceDelegate);return new sh(s,p,h,d).recalculateAndSaveOverlaysForDocumentKeys(new oo(t,Te.at),u).next()})})}}function oh(n){n.createObjectStore("targetDocuments",{keyPath:Tg}).createIndex("documentTargetsIndex",bg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Eg,{unique:!0}),n.createObjectStore("targetGlobal")}const go="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class po{constructor(e,t,r,s,i,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=i,this.window=o,this.document=a,this.Js=c,this.Ys=l,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!po.C())throw new w(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Hg(this,s),this.ii=t+"main",this.It=new Ol(u),this.ri=new Re(this.ii,this.Xs,new op(this.It)),this.Cs=new $g(this.referenceDelegate,this.It),this.remoteDocumentCache=eh(this.It),this.Ns=new Pg,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&ee("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new w(m.FAILED_PRECONDITION,go);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new Te(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,y.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,y.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,y.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>As(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(et(e))return I("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return yr(e).get("owner").next(t=>f.resolve(this.mi(t)))}gi(e){return As(e).delete(this.clientId)}yi(){var e=this;return(0,y.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=ce(r,"clientMetadata");return s.W().next(i=>{const o=e.Ii(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return f.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?f.resolve(!0):yr(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new w(m.FAILED_PRECONDITION,go);return!1}}return!(!this.networkEnabled||!this.inForeground)||As(e).W().next(r=>void 0===this.Ii(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,y.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new oo(t,Te.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>As(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Ss.oe(e,this.It,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new jg(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return xs.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){I("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=15===(o=this.Xs)?Fg:14===o?Fl:13===o?Ll:12===o?Lg:11===o?Ml:void b();var o;let a;return this.ri.runTransaction(e,s,i,u=>(a=new oo(u,this.Ss?this.Ss.next():Te.at),"readwrite-primary"===t?this.fi(a).next(c=>!!c||this.di(a)).next(c=>{if(!c)throw ee(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new w(m.FAILED_PRECONDITION,bc);return r(a)}).next(c=>this.wi(a).next(()=>c)):this.Vi(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Vi(e){return yr(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new w(m.FAILED_PRECONDITION,go)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yr(e).put("owner",t)}static C(){return Re.C()}_i(e){const t=yr(e);return t.get("owner").next(r=>this.mi(r)?(I("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):f.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(ee(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,q.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return I("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ee("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){ee("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function yr(n){return ce(n,"owner")}function As(n){return ce(n,"clientMetadata")}function yo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class vo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=s}static Ci(e,t){let r=k(),s=k();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new vo(e,t.fromCache,r,s)}}class ah{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,s){return this.ki(e,t).next(i=>i||this.Oi(e,t,s,r)).next(i=>i||this.Mi(e,t))}ki(e,t){if(zc(t))return f.resolve(null);let r=Ie(t);return this.indexManager.getIndexType(e,r).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=ms(t,null,"F"),r=Ie(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=k(...i);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Fi(t,a);return this.$i(t,c,o,u.readTime)?this.ki(e,ms(t,null,"F")):this.Bi(e,c,t,u)}))})))}Oi(e,t,r,s){return zc(t)||s.isEqual(D.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(i=>{const o=this.Fi(t,i);return this.$i(t,o,r,s)?this.Mi(e,t):(qi()<=pt.in.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ji(t)),this.Bi(e,o,t,Ec(s,-1)))})}Fi(e,t){let r=new B(Wc(e));return t.forEach((s,i)=>{eo(e,i)&&(r=r.add(i))}),r}$i(e,t,r,s){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Mi(e,t){return qi()<=pt.in.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Ji(t)),this.Ni.getDocumentsMatchingQuery(e,t,De.min())}Bi(e,t,r,s){return this.Ni.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class ap{constructor(e,t,r,s){this.persistence=e,this.Li=t,this.It=s,this.Ui=new Y(N),this.qi=new ot(i=>Dt(i),Jn),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sh(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ui))}}function uh(n,e,t,r){return new ap(n,e,t,r)}function ch(n,e){return wo.apply(this,arguments)}function wo(){return wo=(0,y.Z)(function*(n,e){const t=x(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=k();for(const c of s){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of i){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({ji:c,removedBatchIds:o,addedBatchIds:a}))})})}),wo.apply(this,arguments)}function up(n,e){const t=x(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const l=u.batch,h=l.keys();let d=f.resolve();return h.forEach(p=>{d=d.next(()=>c.getEntry(a,p)).next(v=>{const E=u.docVersions.get(p);C(null!==E),v.version.compareTo(E)<0&&(l.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),c.addEntry(v)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=k();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(a=a.add(o.batch.mutations[u].key));return a}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function lh(n){const e=x(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function cp(n,e){const t=x(n),r=e.snapshotVersion;let s=t.Ui;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Gi.newChangeBuffer({trackRemovals:!0});s=t.Ui;const a=[];e.targetChanges.forEach((l,h)=>{const d=s.get(h);if(!d)return;a.push(t.Cs.removeMatchingKeys(i,l.removedDocuments,h).next(()=>t.Cs.addMatchingKeys(i,l.addedDocuments,h)));let p=d.withSequenceNumber(i.currentSequenceNumber);var v,E,T;e.targetMismatches.has(h)?p=p.withResumeToken(se.EMPTY_BYTE_STRING,D.min()).withLastLimboFreeSnapshotVersion(D.min()):l.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(l.resumeToken,r)),s=s.insert(h,p),E=p,T=l,(0===(v=d).resumeToken.approximateByteSize()||E.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0)&&a.push(t.Cs.updateTargetData(i,p))});let u=be(),c=k();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(hh(i,o,e.documentUpdates).next(l=>{u=l.Wi,c=l.zi})),!r.isEqual(D.min())){const l=t.Cs.getLastRemoteSnapshotVersion(i).next(h=>t.Cs.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.Ui=s,i))}function hh(n,e,t){let r=k(),s=k();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=be();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(D.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):I("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Wi:o,zi:s}})}function lp(n,e){const t=x(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function fn(n,e){const t=x(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Cs.getTargetData(r,e).next(i=>i?(s=i,f.resolve(s)):t.Cs.allocateTargetId(r).next(o=>(s=new at(e,o,0,r.currentSequenceNumber),t.Cs.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ui.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ui=t.Ui.insert(r.targetId,r),t.qi.set(e,r.targetId)),r})}function mn(n,e,t){return Io.apply(this,arguments)}function Io(){return Io=(0,y.Z)(function*(n,e,t){const r=x(n),s=r.Ui.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!et(o))throw o;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ui=r.Ui.remove(e),r.qi.delete(s.target)}),Io.apply(this,arguments)}function Ns(n,e,t){const r=x(n);let s=D.min(),i=k();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const l=x(a),h=l.qi.get(c);return void 0!==h?f.resolve(l.Ui.get(h)):l.Cs.getTargetData(u,c)}(r,o,Ie(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Li.getDocumentsMatchingQuery(o,e,t?s:D.min(),t?i:k())).next(a=>(mh(r,Hc(e),a),{documents:a,Hi:i})))}function dh(n,e){const t=x(n),r=x(t.Cs),s=t.Ui.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.se(i,e).next(o=>o?o.target:null))}function fh(n,e){const t=x(n),r=t.Ki.get(e)||D.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Gi.getAllFromCollectionGroup(s,e,Ec(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(mh(t,e,s),s))}function mh(n,e,t){let r=n.Ki.get(e)||D.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Ki.set(e,r)}function _o(){return _o=(0,y.Z)(function*(n,e,t,r){const s=x(n);let i=k(),o=be();for(const c of t){const l=e.Ji(c.metadata.name);c.document&&(i=i.add(l));const h=e.Yi(c);h.setReadTime(e.Xi(c.metadata.readTime)),o=o.insert(l,h)}const a=s.Gi.newChangeBuffer({trackRemovals:!0}),u=yield fn(s,(c=r,Ie(nn(L.fromString(`__bundle__/docs/${c}`)))));var c;return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>hh(c,a,o).next(l=>(a.apply(c),l)).next(l=>s.Cs.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Cs.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,l.Wi,l.zi)).next(()=>l.Wi)))}),_o.apply(this,arguments)}function dp(n,e){return xo.apply(this,arguments)}function xo(){return xo=(0,y.Z)(function*(n,e,t=k()){const r=yield fn(n,Ie(lo(e.bundledQuery))),s=x(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=ue(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ns.saveNamedQuery(i,e);const a=r.withResumeToken(se.EMPTY_BYTE_STRING,o);return s.Ui=s.Ui.insert(a.targetId,a),s.Cs.updateTargetData(i,a).next(()=>s.Cs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Cs.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ns.saveNamedQuery(i,e))})}),xo.apply(this,arguments)}function gh(n,e){return`firestore_clients_${n}_${e}`}function ph(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Eo(n,e){return`firestore_targets_${n}_${e}`}class ks{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Zi(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new w(s.error.code,s.error.message))),o?new ks(e,t,s.state,i):(ee("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new w(r.error.code,r.error.message))),i?new vr(e,r.state,s):(ee("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Rs{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=vs();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Rc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Rs(e,i):(ee("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class To{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new To(t.clientId,t.onlineState):(ee("SharedClientState",`Failed to parse online state: ${e}`),null)}}class bo{constructor(){this.activeTargetIds=vs()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class So{constructor(e,t,r,s,i){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new Y(N),this.started=!1,this.cr=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=gh(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new bo),this.lr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,y.Z)(function*(){const t=yield e.syncEngine.vi();for(const s of t){if(s===e.sr)continue;const i=e.getItem(gh(e.persistenceKey,s));if(i){const o=Rs.Zi(s,i);o&&(e.ur=e.ur.insert(o.clientId,o))}}e.gr();const r=e.storage.getItem(e.wr);if(r){const s=e.yr(r);s&&e.pr(s)}for(const s of e.cr)e.rr(s);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Eo(this.persistenceKey,e));if(r){const s=vr.Zi(e,r);s&&(t=s.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Eo(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Er(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return I("SharedClientState","READ",e,t),t}setItem(e,t){I("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){I("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(I("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ar)return void ee("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,y.Z)(function*(){if(t.started){if(null!==r.key)if(t.lr.test(r.key)){if(null==r.newValue){const s=t.vr(r.key);return t.Vr(s,null)}{const s=t.Sr(r.key,r.newValue);if(s)return t.Vr(s.clientId,s)}}else if(t.dr.test(r.key)){if(null!==r.newValue){const s=t.Dr(r.key,r.newValue);if(s)return t.Cr(s)}}else if(t._r.test(r.key)){if(null!==r.newValue){const s=t.Nr(r.key,r.newValue);if(s)return t.kr(s)}}else if(r.key===t.wr){if(null!==r.newValue){const s=t.yr(r.newValue);if(s)return t.pr(s)}}else if(r.key===t.hr){const s=function(i){let o=Te.at;if(null!=i)try{const a=JSON.parse(i);C("number"==typeof a),o=a}catch(a){ee("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Te.at&&t.sequenceNumberHandler(s)}else if(r.key===t.mr){const s=t.Or(r.newValue);yield Promise.all(s.map(i=>t.syncEngine.Mr(i)))}}else t.cr.push(r)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const s=new ks(this.currentUser,e,t,r),i=ph(this.persistenceKey,this.currentUser,e);this.setItem(i,s.tr())}Er(e){const t=ph(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,r){const s=Eo(this.persistenceKey,e),i=new vr(e,t,r);this.setItem(s,i.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return Rs.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),s=Number(r[1]);return ks.Zi(new ae(void 0!==r[2]?r[2]:null),s,t)}Nr(e,t){const r=this._r.exec(e),s=Number(r[1]);return vr.Zi(s,t)}yr(e){return To.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,y.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);I("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),s=this.Ir(this.ur),i=this.Ir(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.Br(o,a).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=vs();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class yh{constructor(){this.Lr=new bo,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,t,r){this.Ur[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new bo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fp{qr(e){}shutdown(){}}class vh{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const mp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class gp{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class pp extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,s,i){const o=this.ho(e,t);I("RestConnection","Sending: ",o,r);const a={};return this.lo(a,s,i),this.fo(e,o,a,r).then(u=>(I("RestConnection","Received: ",u),u),u=>{throw _t("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}_o(e,t,r,s,i,o){return this.ao(e,t,r,s,i)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Yt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}ho(e,t){return`${this.oo}/v1/${t}:${mp[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,s){return new Promise((i,o)=>{const a=new mm;a.setWithCredentials(!0),a.listenOnce(hm.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Bi.NO_ERROR:const c=a.getResponseJson();I("Connection","XHR received:",JSON.stringify(c)),i(c);break;case Bi.TIMEOUT:I("Connection",'RPC "'+e+'" timed out'),o(new w(m.DEADLINE_EXCEEDED,"Request time out"));break;case Bi.HTTP_ERROR:const l=a.getStatus();if(I("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){const h=a.getResponseJson().error;if(h&&h.status&&h.message){const d=function(p){const v=p.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(v)>=0?v:m.UNKNOWN}(h.status);o(new w(d,h.message))}else o(new w(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new w(m.UNAVAILABLE,"Connection failed."));break;default:b()}}finally{I("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}wo(e,t,r){const s=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=cm(),o=lm(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new fm({})),this.lo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=s.join("");I("Connection","Creating WebChannel: "+u,a);const c=i.createWebChannel(u,a);let l=!1,h=!1;const d=new gp({Hr:v=>{h?I("Connection","Not sending because WebChannel is closed:",v):(l||(I("Connection","Opening WebChannel transport."),c.open(),l=!0),I("Connection","WebChannel sending:",v),c.send(v))},Jr:()=>c.close()}),p=(v,E,T)=>{v.listen(E,P=>{try{T(P)}catch(G){setTimeout(()=>{throw G},0)}})};return p(c,is.EventType.OPEN,()=>{h||I("Connection","WebChannel transport opened.")}),p(c,is.EventType.CLOSE,()=>{h||(h=!0,I("Connection","WebChannel transport closed"),d.io())}),p(c,is.EventType.ERROR,v=>{h||(h=!0,_t("Connection","WebChannel transport errored:",v),d.io(new w(m.UNAVAILABLE,"The operation could not be completed")))}),p(c,is.EventType.MESSAGE,v=>{var E;if(!h){const T=v.data[0];C(!!T);const P=T,G=P.error||(null===(E=P[0])||void 0===E?void 0:E.error);if(G){I("Connection","WebChannel received error:",G);const O=G.status;let J=function(U){const ie=ne[U];if(void 0!==ie)return hl(ie)}(O),V=G.message;void 0===J&&(J=m.INTERNAL,V="Unknown error status: "+O+" with message "+G.message),h=!0,d.io(new w(J,V)),c.close()}else I("Connection","WebChannel received:",T),d.ro(T)}}),p(o,dm.STAT_EVENT,v=>{v.stat===yc.PROXY?I("Connection","Detected buffering proxy"):v.stat===yc.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function wh(){return typeof window<"u"?window:null}function Ms(){return typeof document<"u"?document:null}function wr(n){return new ag(n,!0)}class Co{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=s,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),s=Math.max(0,t-r);s>0&&I("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,s,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Ih{constructor(e,t,r,s,i,o,a,u){this.Hs=e,this.vo=r,this.Vo=s,this.So=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new Co(e,t)}ko(){return 1===this.state||5===this.state||this.Oo()}Oo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Mo()}stop(){var e=this;return(0,y.Z)(function*(){e.ko()&&(yield e.close(0))})()}Fo(){this.state=0,this.No.reset()}$o(){this.Oo()&&null===this.Co&&(this.Co=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.Bo()))}Lo(e){this.Uo(),this.stream.send(e)}Bo(){var e=this;return(0,y.Z)(function*(){if(e.Oo())return e.close(0)})()}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}close(e,t){var r=this;return(0,y.Z)(function*(){r.Uo(),r.qo(),r.No.cancel(),r.Do++,4!==e?r.No.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(ee(t.toString()),ee("Using maximum backoff delay to prevent overloading the backend."),r.No.Ao()):t&&t.code===m.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Ko(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Ko(){}auth(){this.state=1;const e=this.Go(this.Do),t=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Do===t&&this.Qo(r,s)},r=>{e(()=>{const s=new w(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.jo(s)})})}Qo(e,t){const r=this.Go(this.Do);this.stream=this.Wo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.xo=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.Oo()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(s=>{r(()=>this.jo(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Mo(){var e=this;this.state=5,this.No.Ro((0,y.Z)(function*(){e.state=0,e.start()}))}jo(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Go(e){return t=>{this.Hs.enqueueAndForget(()=>this.Do===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class yp extends Ih{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.It=i}Wo(e,t){return this.So.wo("Listen",e,t)}onMessage(e){this.No.reset();const t=function lg(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:b(),s=e.targetChange.targetIds||[],i=function(u,c){return u.gt?(C(void 0===c||"string"==typeof c),se.fromBase64String(c||"")):(C(void 0===c||c instanceof Uint8Array),se.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?m.UNKNOWN:hl(u.code);return new w(c,u.message||"")}(o);t=new pl(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=Pe(n,r.document.name),i=ue(r.document.updateTime),o=new me({mapValue:{fields:r.document.fields}}),a=K.newFoundDocument(s,i,o);t=new ws(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=Pe(n,r.document),i=r.readTime?ue(r.readTime):D.min(),o=K.newNoDocument(s,i);t=new ws([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=Pe(n,r.document);t=new ws([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return b();{const r=e.filter,i=new Jm(r.count||0);t=new gl(r.targetId,i)}}var u;return t}(this.It,e),r=function(s){if(!("targetChange"in s))return D.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?D.min():i.readTime?ue(i.readTime):D.min()}(e);return this.listener.zo(t,r)}Ho(e){const t={};t.database=cr(this.It),t.addTarget=function(s,i){let o;const a=i.target;return o=ds(a)?{documents:Sl(s,a)}:{query:io(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=Il(s,i.resumeToken):i.snapshotVersion.compareTo(D.min())>0&&(o.readTime=ar(s,i.snapshotVersion.toTimestamp())),o}(this.It,e);const r=function dg(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return b()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Lo(t)}Jo(e){const t={};t.database=cr(this.It),t.removeTarget=e,this.Lo(t)}}class vp extends Ih{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.It=i,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(e,t){return this.So.wo("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Yo){this.No.reset();const t=function hg(n,e){return n&&n.length>0?(C(void 0!==e),n.map(t=>function(r,s){let i=ue(r.updateTime?r.updateTime:s);return i.isEqual(D.min())&&(i=ue(s)),new Wm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ue(e.commitTime);return this.listener.tu(r,t)}return C(!e.writeResults||0===e.writeResults.length),this.Yo=!0,this.listener.eu()}nu(){const e={};e.database=cr(this.It),this.Lo(e)}Zo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>lr(this.It,r))};this.Lo(t)}}class wp extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.So=r,this.It=s,this.su=!1}iu(){if(this.su)throw new w(m.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.So.ao(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new w(m.UNKNOWN,s.toString())})}_o(e,t,r,s){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.So._o(e,t,r,i,o,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new w(m.UNKNOWN,i.toString())})}terminate(){this.su=!0}}class _p{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}cu(){0===this.ru&&(this.au("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.au("Offline"),Promise.resolve())))}lu(e){"Online"===this.state?this.au("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.au("Offline")))}set(e){this.fu(),this.ru=0,"Online"===e&&(this.uu=!1),this.au(e)}au(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}hu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(ee(t),this.uu=!1):I("OnlineStateTracker",t)}fu(){null!==this.ou&&(this.ou.cancel(),this.ou=null)}}class xp{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=i,this.gu.qr(a=>{r.enqueueAndForget((0,y.Z)(function*(){var u;Qe(o)&&(I("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,y.Z)(function*(c){const l=x(c);l.wu.add(4),yield gn(l),l.yu.set("Unknown"),l.wu.delete(4),yield Ir(l)}),function(c){return u.apply(this,arguments)})(o))}))}),this.yu=new _p(r,s)}}function Ir(n){return Ao.apply(this,arguments)}function Ao(){return Ao=(0,y.Z)(function*(n){if(Qe(n))for(const e of n.mu)yield e(!0)}),Ao.apply(this,arguments)}function gn(n){return No.apply(this,arguments)}function No(){return No=(0,y.Z)(function*(n){for(const e of n.mu)yield e(!1)}),No.apply(this,arguments)}function Ls(n,e){const t=x(n);t._u.has(e.targetId)||(t._u.set(e.targetId,e),Mo(t)?Ro(t):yn(t).Oo()&&ko(t,e))}function _r(n,e){const t=x(n),r=yn(t);t._u.delete(e),r.Oo()&&_h(t,e),0===t._u.size&&(r.Oo()?r.$o():Qe(t)&&t.yu.set("Unknown"))}function ko(n,e){n.pu.Mt(e.targetId),yn(n).Ho(e)}function _h(n,e){n.pu.Mt(e),yn(n).Jo(e)}function Ro(n){n.pu=new sg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),se:e=>n._u.get(e)||null}),yn(n).start(),n.yu.cu()}function Mo(n){return Qe(n)&&!yn(n).ko()&&n._u.size>0}function Qe(n){return 0===x(n).wu.size}function xh(n){n.pu=void 0}function Ep(n){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,y.Z)(function*(n){n._u.forEach((e,t)=>{ko(n,e)})}),Lo.apply(this,arguments)}function Tp(n,e){return Fo.apply(this,arguments)}function Fo(){return Fo=(0,y.Z)(function*(n,e){xh(n),Mo(n)?(n.yu.lu(e),Ro(n)):n.yu.set("Unknown")}),Fo.apply(this,arguments)}function bp(n,e,t){return Oo.apply(this,arguments)}function Oo(){return Oo=(0,y.Z)(function*(n,e,t){if(n.yu.set("Online"),e instanceof pl&&2===e.state&&e.cause)try{yield(r=(0,y.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s._u.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s._u.delete(a),s.pu.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Fs(n,r)}else if(e instanceof ws?n.pu.Gt(e):e instanceof gl?n.pu.Yt(e):n.pu.Wt(e),!t.isEqual(D.min()))try{const r=yield lh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.pu.te(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s._u.get(u);c&&s._u.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s._u.get(a);if(!u)return;s._u.set(a,u.withResumeToken(se.EMPTY_BYTE_STRING,u.snapshotVersion)),_h(s,a);const c=new at(u.target,a,1,u.sequenceNumber);ko(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){I("RemoteStore","Failed to raise snapshot:",r),yield Fs(n,r)}var r}),Oo.apply(this,arguments)}function Fs(n,e,t){return Po.apply(this,arguments)}function Po(){return Po=(0,y.Z)(function*(n,e,t){if(!et(e))throw e;n.wu.add(1),yield gn(n),n.yu.set("Offline"),t||(t=()=>lh(n.localStore)),n.asyncQueue.enqueueRetryable((0,y.Z)(function*(){I("RemoteStore","Retrying IndexedDB access"),yield t(),n.wu.delete(1),yield Ir(n)}))}),Po.apply(this,arguments)}function Eh(n,e){return e().catch(t=>Fs(n,t,e))}function pn(n){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,y.Z)(function*(n){const e=x(n),t=lt(e);let r=e.du.length>0?e.du[e.du.length-1].batchId:-1;for(;Sp(e);)try{const s=yield lp(e.localStore,r);if(null===s){0===e.du.length&&t.$o();break}r=s.batchId,Cp(e,s)}catch(s){yield Fs(e,s)}Th(e)&&bh(e)}),Vo.apply(this,arguments)}function Sp(n){return Qe(n)&&n.du.length<10}function Cp(n,e){n.du.push(e);const t=lt(n);t.Oo()&&t.Xo&&t.Zo(e.mutations)}function Th(n){return Qe(n)&&!lt(n).ko()&&n.du.length>0}function bh(n){lt(n).start()}function Dp(n){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,y.Z)(function*(n){lt(n).nu()}),Uo.apply(this,arguments)}function Ap(n){return Bo.apply(this,arguments)}function Bo(){return Bo=(0,y.Z)(function*(n){const e=lt(n);for(const t of n.du)e.Zo(t.mutations)}),Bo.apply(this,arguments)}function Np(n,e,t){return qo.apply(this,arguments)}function qo(){return qo=(0,y.Z)(function*(n,e,t){const r=n.du.shift(),s=uo.from(r,e,t);yield Eh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield pn(n)}),qo.apply(this,arguments)}function kp(n,e){return Go.apply(this,arguments)}function Go(){return Go=(0,y.Z)(function*(n,e){var t;e&&lt(n).Xo&&(yield(t=(0,y.Z)(function*(r,s){if(ll(i=s.code)&&i!==m.ABORTED){const o=r.du.shift();lt(r).Fo(),yield Eh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield pn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),Th(n)&&bh(n)}),Go.apply(this,arguments)}function Sh(n,e){return Ko.apply(this,arguments)}function Ko(){return Ko=(0,y.Z)(function*(n,e){const t=x(n);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const r=Qe(t);t.wu.add(3),yield gn(t),r&&t.yu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.wu.delete(3),yield Ir(t)}),Ko.apply(this,arguments)}function jo(n,e){return $o.apply(this,arguments)}function $o(){return $o=(0,y.Z)(function*(n,e){const t=x(n);e?(t.wu.delete(2),yield Ir(t)):e||(t.wu.add(2),yield gn(t),t.yu.set("Unknown"))}),$o.apply(this,arguments)}function yn(n){return n.Iu||(n.Iu=function(e,t,r){const s=x(e);return s.iu(),new yp(t,s.So,s.authCredentials,s.appCheckCredentials,s.It,r)}(n.datastore,n.asyncQueue,{Yr:Ep.bind(null,n),Zr:Tp.bind(null,n),zo:bp.bind(null,n)}),n.mu.push(function(){var e=(0,y.Z)(function*(t){t?(n.Iu.Fo(),Mo(n)?Ro(n):n.yu.set("Unknown")):(yield n.Iu.stop(),xh(n))});return function(t){return e.apply(this,arguments)}}())),n.Iu}function lt(n){return n.Tu||(n.Tu=function(e,t,r){const s=x(e);return s.iu(),new vp(t,s.So,s.authCredentials,s.appCheckCredentials,s.It,r)}(n.datastore,n.asyncQueue,{Yr:Dp.bind(null,n),Zr:kp.bind(null,n),eu:Ap.bind(null,n),tu:Np.bind(null,n)}),n.mu.push(function(){var e=(0,y.Z)(function*(t){t?(n.Tu.Fo(),yield pn(n)):(yield n.Tu.stop(),n.du.length>0&&(I("RemoteStore",`Stopping write stream with ${n.du.length} pending writes`),n.du=[]))});return function(t){return e.apply(this,arguments)}}())),n.Tu}class Qo{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new re,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Qo(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new w(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vn(n,e){if(ee("AsyncQueue",`${e}: ${n}`),et(n))return new w(m.UNAVAILABLE,`${e}: ${n}`);throw n}class wn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||_.comparator(t.key,r.key):(t,r)=>_.comparator(t.key,r.key),this.keyedMap=rr(),this.sortedSet=new Y(this.comparator)}static emptySet(e){return new wn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof wn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new wn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Ch{constructor(){this.Eu=new Y(_.comparator)}track(e){const t=e.doc.key,r=this.Eu.get(t);r?0!==e.type&&3===r.type?this.Eu=this.Eu.insert(t,e):3===e.type&&1!==r.type?this.Eu=this.Eu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Eu=this.Eu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Eu=this.Eu.remove(t):1===e.type&&2===r.type?this.Eu=this.Eu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):b():this.Eu=this.Eu.insert(t,e)}Au(){const e=[];return this.Eu.inorderTraversal((t,r)=>{e.push(r)}),e}}class In{constructor(e,t,r,s,i,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new In(e,t,wn.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&er(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Rp{constructor(){this.Ru=void 0,this.listeners=[]}}class Mp{constructor(){this.queries=new ot(e=>Zc(e),er),this.onlineState="Unknown",this.bu=new Set}}function zo(n,e){return Zo.apply(this,arguments)}function Zo(){return Zo=(0,y.Z)(function*(n,e){const t=x(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Rp),s)try{i.Ru=yield t.onListen(r)}catch(o){const a=vn(o,`Initialization of query '${Ji(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.Pu(t.onlineState),i.Ru&&e.vu(i.Ru)&&Yo(t)}),Zo.apply(this,arguments)}function Ho(n,e){return Wo.apply(this,arguments)}function Wo(){return Wo=(0,y.Z)(function*(n,e){const t=x(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),Wo.apply(this,arguments)}function Lp(n,e){const t=x(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.vu(s)&&(r=!0);o.Ru=s}}r&&Yo(t)}function Fp(n,e,t){const r=x(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function Yo(n){n.bu.forEach(e=>{e.next()})}class Xo{constructor(e,t,r){this.query=e,this.Vu=t,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=r||{}}vu(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new In(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Su?this.Cu(e)&&(this.Vu.next(e),t=!0):this.xu(e,this.onlineState)&&(this.Nu(e),t=!0),this.Du=e,t}onError(e){this.Vu.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Du&&!this.Su&&this.xu(this.Du,e)&&(this.Nu(this.Du),t=!0),t}xu(e,t){return!e.fromCache||(!this.options.ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Cu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Du&&this.Du.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Nu(e){e=In.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Su=!0,this.Vu.next(e)}}class Op{constructor(e,t){this.payload=e,this.byteLength=t}Ou(){return"metadata"in this.payload}}class Dh{constructor(e){this.It=e}Ji(e){return Pe(this.It,e)}Yi(e){return e.metadata.exists?bl(this.It,e.document,!1):K.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return ue(e)}}class Pp{constructor(e,t,r){this.Mu=e,this.localStore=t,this.It=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ah(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const r=L.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new Dh(this.It);for(const s of e)if(s.metadata.queries){const i=r.Ji(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||k()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,y.Z)(function*(){const t=yield function hp(n,e,t,r){return _o.apply(this,arguments)}(e.localStore,new Dh(e.It),e.documents,e.Mu.id),r=e.$u(e.documents);for(const s of e.queries)yield dp(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function Ah(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Nh{constructor(e){this.key=e}}class kh{constructor(e){this.key=e}}class Rh{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=k(),this.mutatedKeys=k(),this.Gu=Wc(e),this.Qu=new wn(this.Gu)}get ju(){return this.Uu}Wu(e,t){const r=t?t.zu:new Ch,s=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{const d=s.get(l),p=eo(this.query,h)?h:null,v=!!d&&this.mutatedKeys.has(d.key),E=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let T=!1;d&&p?d.data.isEqual(p.data)?v!==E&&(r.track({type:3,doc:p}),T=!0):this.Hu(d,p)||(r.track({type:2,doc:p}),T=!0,(u&&this.Gu(p,u)>0||c&&this.Gu(p,c)<0)&&(a=!0)):!d&&p?(r.track({type:0,doc:p}),T=!0):d&&!p&&(r.track({type:1,doc:d}),T=!0,(u||c)&&(a=!0)),T&&(p?(o=o.add(p),i=E?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Qu:o,zu:r,$i:a,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Au();i.sort((c,l)=>function(h,d){const p=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return b()}};return p(h)-p(d)}(c.type,l.type)||this.Gu(c.doc,l.doc)),this.Ju(r);const o=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,u=a!==this.qu;return this.qu=a,0!==i.length||u?{snapshot:new In(this.query,e.Qu,s,i,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Ch,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.Uu=this.Uu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Uu=this.Uu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=k(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new kh(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new Nh(r))}),t}tc(e){this.Uu=e.Hi,this.Ku=k();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return In.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class Vp{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Up{constructor(e){this.key=e,this.nc=!1}}class Bp{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new ot(a=>Zc(a),er),this.rc=new Map,this.oc=new Set,this.uc=new Y(_.comparator),this.cc=new Map,this.ac=new mo,this.hc={},this.lc=new Map,this.fc=Pt.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function qp(n,e){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,y.Z)(function*(n,e){const t=xa(n);let r,s;const i=t.ic.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const o=yield fn(t.localStore,Ie(e));t.isPrimaryClient&&Ls(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield ea(t,e,r,"current"===a,o.resumeToken)}return s}),Jo.apply(this,arguments)}function ea(n,e,t,r,s){return ta.apply(this,arguments)}function ta(){return ta=(0,y.Z)(function*(n,e,t,r,s){n._c=(h,d,p)=>{return(v=(0,y.Z)(function*(E,T,P,G){let O=T.view.Wu(P);O.$i&&(O=yield Ns(E.localStore,T.query,!1).then(({documents:U})=>T.view.Wu(U,O)));const J=G&&G.targetChanges.get(T.targetId),V=T.view.applyChanges(O,E.isPrimaryClient,J);return ha(E,T.targetId,V.Xu),V.snapshot}),function(E,T,P,G){return v.apply(this,arguments)})(n,h,d,p);var v};const i=yield Ns(n.localStore,e,!0),o=new Rh(e,i.Hi),a=o.Wu(i.documents),u=or.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=o.applyChanges(a,n.isPrimaryClient,u);ha(n,t,c.Xu);const l=new Vp(e,t,o);return n.ic.set(e,l),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),c.snapshot}),ta.apply(this,arguments)}function Gp(n,e){return na.apply(this,arguments)}function na(){return na=(0,y.Z)(function*(n,e){const t=x(n),r=t.ic.get(e),s=t.rc.get(r.targetId);if(s.length>1)return t.rc.set(r.targetId,s.filter(i=>!er(i,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield mn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),_r(t.remoteStore,r.targetId),_n(t,r.targetId)}).catch(Je))):(_n(t,r.targetId),yield mn(t.localStore,r.targetId,!0))}),na.apply(this,arguments)}function ra(){return ra=(0,y.Z)(function*(n,e,t){const r=Ea(n);try{const s=yield function(i,o){const a=x(i),u=z.now(),c=o.reduce((d,p)=>d.add(p.key),k());let l,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let p=be(),v=k();return a.Gi.getEntries(d,c).next(E=>{p=E,p.forEach((T,P)=>{P.isValidDocument()||(v=v.add(T))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,p)).next(E=>{l=E;const T=[];for(const P of o){const G=Xm(P,l.get(P.key).overlayedDocument);null!=G&&T.push(new $e(P.key,G,Uc(G.value.mapValue),Z.exists(!0)))}return a.mutationQueue.addMutationBatch(d,u,T,o)}).next(E=>{h=E;const T=E.applyToLocalDocumentSet(l,v);return a.documentOverlayCache.saveOverlays(d,E.batchId,T)})}).then(()=>({batchId:h.batchId,changes:fl(l)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.hc[i.currentUser.toKey()];u||(u=new Y(N)),u=u.insert(o,a),i.hc[i.currentUser.toKey()]=u}(r,s.batchId,t),yield ze(r,s.changes),yield pn(r.remoteStore)}catch(s){const i=vn(s,"Failed to persist write");t.reject(i)}}),ra.apply(this,arguments)}function Mh(n,e){return sa.apply(this,arguments)}function sa(){return sa=(0,y.Z)(function*(n,e){const t=x(n);try{const r=yield cp(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.cc.get(i);o&&(C(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.nc=!0:s.modifiedDocuments.size>0?C(o.nc):s.removedDocuments.size>0&&(C(o.nc),o.nc=!1))}),yield ze(t,r,e)}catch(r){yield Je(r)}}),sa.apply(this,arguments)}function Lh(n,e,t){const r=x(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.ic.forEach((i,o)=>{const a=o.view.Pu(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=x(i);a.onlineState=o;let u=!1;a.queries.forEach((c,l)=>{for(const h of l.listeners)h.Pu(o)&&(u=!0)}),u&&Yo(a)}(r.eventManager,e),s.length&&r.sc.zo(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function jp(n,e,t){return ia.apply(this,arguments)}function ia(){return ia=(0,y.Z)(function*(n,e,t){const r=x(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.cc.get(e),i=s&&s.key;if(i){let o=new Y(_.comparator);o=o.insert(i,K.newNoDocument(i,D.min()));const a=k().add(i),u=new ir(D.min(),new Map,new B(N),o,a);yield Mh(r,u),r.uc=r.uc.remove(i),r.cc.delete(e),da(r)}else yield mn(r.localStore,e,!1).then(()=>_n(r,e,t)).catch(Je)}),ia.apply(this,arguments)}function $p(n,e){return oa.apply(this,arguments)}function oa(){return oa=(0,y.Z)(function*(n,e){const t=x(n),r=e.batch.batchId;try{const s=yield up(t.localStore,e);la(t,r,null),ca(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ze(t,s)}catch(s){yield Je(s)}}),oa.apply(this,arguments)}function Qp(n,e,t){return aa.apply(this,arguments)}function aa(){return aa=(0,y.Z)(function*(n,e,t){const r=x(n);try{const s=yield function(i,o){const a=x(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.mutationQueue.lookupMutationBatch(u,o).next(l=>(C(null!==l),c=l.keys(),a.mutationQueue.removeMutationBatch(u,l))).next(()=>a.mutationQueue.performConsistencyCheck(u)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>a.localDocuments.getDocuments(u,c))})}(r.localStore,e);la(r,e,t),ca(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ze(r,s)}catch(s){yield Je(s)}}),aa.apply(this,arguments)}function ua(){return ua=(0,y.Z)(function*(n,e){const t=x(n);Qe(t.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=x(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.lc.get(r)||[];s.push(e),t.lc.set(r,s)}catch(r){const s=vn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),ua.apply(this,arguments)}function ca(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function la(n,e,t){const r=x(n);let s=r.hc[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.hc[r.currentUser.toKey()]=s}}function _n(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||Fh(n,r)})}function Fh(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(_r(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),da(n))}function ha(n,e,t){for(const r of t)r instanceof Nh?(n.ac.addReference(r.key,e),Zp(n,r)):r instanceof kh?(I("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||Fh(n,r.key)):b()}function Zp(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(I("SyncEngine","New document in limbo: "+t),n.oc.add(r),da(n))}function da(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new _(L.fromString(e)),r=n.fc.next();n.cc.set(r,new Up(t)),n.uc=n.uc.insert(t,r),Ls(n.remoteStore,new at(Ie(nn(t.path)),r,2,Te.at))}}function ze(n,e,t){return fa.apply(this,arguments)}function fa(){return fa=(0,y.Z)(function*(n,e,t){const r=x(n),s=[],i=[],o=[];var a;r.ic.isEmpty()||(r.ic.forEach((a,u)=>{o.push(r._c(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){s.push(c);const l=vo.Ci(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.sc.zo(s),yield(a=(0,y.Z)(function*(u,c){const l=x(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.Si,p=>l.persistence.referenceDelegate.addReference(h,d.targetId,p)).next(()=>f.forEach(d.Di,p=>l.persistence.referenceDelegate.removeReference(h,d.targetId,p)))))}catch(h){if(!et(h))throw h;I("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const p=l.Ui.get(d),E=p.withLastLimboFreeSnapshotVersion(p.snapshotVersion);l.Ui=l.Ui.insert(d,E)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))}),fa.apply(this,arguments)}function Hp(n,e){return ma.apply(this,arguments)}function ma(){return ma=(0,y.Z)(function*(n,e){const t=x(n);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const r=yield ch(t.localStore,e);t.currentUser=e,(s=t).lc.forEach(o=>{o.forEach(a=>{a.reject(new w(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ze(t,r.ji)}var s}),ma.apply(this,arguments)}function Wp(n,e){const t=x(n),r=t.cc.get(e);if(r&&r.nc)return k().add(r.key);{let s=k();const i=t.rc.get(e);if(!i)return s;for(const o of i){const a=t.ic.get(o);s=s.unionWith(a.view.ju)}return s}}function Yp(n,e){return ga.apply(this,arguments)}function ga(){return ga=(0,y.Z)(function*(n,e){const t=x(n),r=yield Ns(t.localStore,e.query,!0),s=e.view.tc(r);return t.isPrimaryClient&&ha(t,e.targetId,s.Xu),s}),ga.apply(this,arguments)}function Xp(n,e){return pa.apply(this,arguments)}function pa(){return pa=(0,y.Z)(function*(n,e){const t=x(n);return fh(t.localStore,e).then(r=>ze(t,r))}),pa.apply(this,arguments)}function Jp(n,e,t,r){return ya.apply(this,arguments)}function ya(){return ya=(0,y.Z)(function*(n,e,t,r){const s=x(n),i=yield function(o,a){const u=x(o),c=x(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>c.Tn(l,a).next(h=>h?u.localDocuments.getDocuments(l,h):f.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield pn(s.remoteStore):"acknowledged"===t||"rejected"===t?(la(s,e,r||null),ca(s,e),a=e,x(x(s.localStore).mutationQueue).An(a)):b(),yield ze(s,i)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}),ya.apply(this,arguments)}function va(){return va=(0,y.Z)(function*(n,e){const t=x(n);if(xa(t),Ea(t),!0===e&&!0!==t.dc){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield Oh(t,r.toArray());t.dc=!0,yield jo(t.remoteStore,!0);for(const i of s)Ls(t.remoteStore,i)}else if(!1===e&&!1!==t.dc){const r=[];let s=Promise.resolve();t.rc.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(_n(t,o),mn(t.localStore,o,!0))),_r(t.remoteStore,o)}),yield s,yield Oh(t,r),function(i){const o=x(i);o.cc.forEach((a,u)=>{_r(o.remoteStore,u)}),o.ac.fs(),o.cc=new Map,o.uc=new Y(_.comparator)}(t),t.dc=!1,yield jo(t.remoteStore,!1)}}),va.apply(this,arguments)}function Oh(n,e,t){return wa.apply(this,arguments)}function wa(){return wa=(0,y.Z)(function*(n,e,t){const r=x(n),s=[],i=[];for(const o of e){let a;const u=r.rc.get(o);if(u&&0!==u.length){a=yield fn(r.localStore,Ie(u[0]));for(const c of u){const l=r.ic.get(c),h=yield Yp(r,l);h.snapshot&&i.push(h.snapshot)}}else{const c=yield dh(r.localStore,o);a=yield fn(r.localStore,c),yield ea(r,Ph(c),o,!1,a.resumeToken)}s.push(a)}return r.sc.zo(i),s}),wa.apply(this,arguments)}function Ph(n){return Qc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ty(n){const e=x(n);return x(x(e.localStore).persistence).vi()}function ny(n,e,t,r){return Ia.apply(this,arguments)}function Ia(){return Ia=(0,y.Z)(function*(n,e,t,r){const s=x(n);if(s.dc)return void I("SyncEngine","Ignoring unexpected query state notification.");const i=s.rc.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=yield fh(s.localStore,Hc(i[0])),a=ir.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,se.EMPTY_BYTE_STRING);yield ze(s,o,a);break}case"rejected":yield mn(s.localStore,e,!0),_n(s,e,r);break;default:b()}}),Ia.apply(this,arguments)}function ry(n,e,t){return _a.apply(this,arguments)}function _a(){return _a=(0,y.Z)(function*(n,e,t){const r=xa(n);if(r.dc){for(const s of e){if(r.rc.has(s)){I("SyncEngine","Adding an already active target "+s);continue}const i=yield dh(r.localStore,s),o=yield fn(r.localStore,i);yield ea(r,Ph(i),o.targetId,!1,o.resumeToken),Ls(r.remoteStore,o)}for(const s of t)r.rc.has(s)&&(yield mn(r.localStore,s,!1).then(()=>{_r(r.remoteStore,s),_n(r,s)}).catch(Je))}}),_a.apply(this,arguments)}function xa(n){const e=x(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Mh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jp.bind(null,e),e.sc.zo=Lp.bind(null,e.eventManager),e.sc.wc=Fp.bind(null,e.eventManager),e}function Ea(n){const e=x(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$p.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qp.bind(null,e),e}class Vh{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,y.Z)(function*(){t.It=wr(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return uh(this.persistence,new ah,e.initialUser,this.It)}yc(e){return new ih(Ds.Bs,this.It)}gc(e){return new yh}terminate(){var e=this;return(0,y.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Uh extends Vh{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,y.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield Ea(r.Ac.syncEngine),yield pn(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return uh(this.persistence,new ah,e.initialUser,this.It)}Tc(e,t){return new zg(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Nm(t,this.persistence);return new Am(e.asyncQueue,r)}yc(e){const t=yo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Se.withCacheSize(this.cacheSizeBytes):Se.DEFAULT;return new po(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,wh(),Ms(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(e){return new yh}}class iy extends Uh{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,y.Z)(function*(){yield t().call(r,e);const s=r.Ac.syncEngine;r.sharedClientState instanceof So&&(r.sharedClientState.syncEngine={Fr:Jp.bind(null,s),$r:ny.bind(null,s),Br:ry.bind(null,s),vi:ty.bind(null,s),Mr:Xp.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.li(function(){var i=(0,y.Z)(function*(o){yield function ey(n,e){return va.apply(this,arguments)}(r.Ac.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}gc(e){const t=wh();if(!So.C(t))throw new w(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=yo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new So(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ta{initialize(e,t){var r=this;return(0,y.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>Lh(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=Hp.bind(null,r.syncEngine),yield jo(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Mp}createDatastore(e){const t=wr(e.databaseInfo.databaseId),r=new pp(e.databaseInfo);return new wp(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>Lh(this.syncEngine,a,0),o=vh.C()?new vh:new fp,new xp(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const l=new Bp(r,s,i,o,a,u);return c&&(l.dc=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,y.Z)(function*(t){const r=x(t);I("RemoteStore","RemoteStore shutting down."),r.wu.add(5),yield gn(r),r.gu.shutdown(),r.yu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function ba(n,e,t){if(!t)throw new w(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Bh(n,e,t,r){if(!0===e&&!0===r)throw new w(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function qh(n){if(!_.isDocumentKey(n))throw new w(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Gh(n){if(_.isDocumentKey(n))throw new w(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Os(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":b()}function M(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new w(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Os(n);throw new w(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Kh(n,e){if(e<=0)throw new w(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const jh=new Map;class $h{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new w(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new w(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Bh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xr{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $h({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new w(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new w(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $h(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new ym;switch(t.type){case"gapi":return new _m(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new w(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=jh.get(e);t&&(I("ComponentProvider","Removing Datastore"),jh.delete(e),t.terminate())}(this),Promise.resolve()}}class j{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ue(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new j(this.firestore,e,this._key)}}class ve{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ve(this.firestore,e,this._query)}}class Ue extends ve{constructor(e,t,r){super(e,t,nn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new j(this.firestore,null,new _(e))}withConverter(e){return new Ue(this.firestore,e,this._path)}}function zh(n,e,...t){if(n=(0,q.m9)(n),ba("collection","path",e),n instanceof xr){const r=L.fromString(e,...t);return Gh(r),new Ue(n,null,r)}{if(!(n instanceof j||n instanceof Ue))throw new w(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(L.fromString(e,...t));return Gh(r),new Ue(n.firestore,null,r)}}function Ps(n,e,...t){if(n=(0,q.m9)(n),1===arguments.length&&(e=_c.R()),ba("doc","path",e),n instanceof xr){const r=L.fromString(e,...t);return qh(r),new j(n,null,new _(r))}{if(!(n instanceof j||n instanceof Ue))throw new w(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(L.fromString(e,...t));return qh(r),new j(n.firestore,n instanceof Ue?n.converter:null,new _(r))}}function Zh(n,e){return n=(0,q.m9)(n),e=(0,q.m9)(e),(n instanceof j||n instanceof Ue)&&(e instanceof j||e instanceof Ue)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Sa(n,e){return n=(0,q.m9)(n),e=(0,q.m9)(e),n instanceof ve&&e instanceof ve&&n.firestore===e.firestore&&er(n._query,e._query)&&n.converter===e.converter}function Hh(n,e=10240){let t=0;return{read:()=>(0,y.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,y.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Vs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):ee("Uncaught Error in snapshot listener:",e)}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ay{constructor(e,t){this.Pc=e,this.It=t,this.metadata=new re,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,y.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,y.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,y.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const r=e.vc.decode(t),s=Number(r);isNaN(s)&&e.Dc(`length string (${r}) is not valid number`);const i=yield e.Cc(s);return new Op(JSON.parse(i),t.length+s)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,y.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Cc(e){var t=this;return(0,y.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const r=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,y.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class ly{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,y.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new w(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,y.Z)(function*(i,o){const a=x(i),u=cr(a.It)+"/documents",c={documents:o.map(p=>ur(a.It,p))},l=yield a._o("BatchGetDocuments",u,c,o.length),h=new Map;l.forEach(p=>{const v=function cg(n,e){return"found"in e?function(t,r){C(!!r.found);const s=Pe(t,r.found.name),i=ue(r.found.updateTime),o=new me({mapValue:{fields:r.found.fields}});return K.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){C(!!r.missing),C(!!r.readTime);const s=Pe(t,r.missing),i=ue(r.readTime);return K.newNoDocument(s,i)}(n,e):b()}(a.It,p);h.set(v.key.toString(),v)});const d=[];return o.forEach(p=>{const v=h.get(p.toString());C(!!v),d.push(v)}),d}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new un(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,y.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=_.fromPath(s);e.mutations.push(new to(i,e.precondition(i)))}),yield(r=(0,y.Z)(function*(s,i){const o=x(s),a=cr(o.It)+"/documents",u={writes:i.map(c=>lr(o.It,c))};yield o.ao("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw b();t=D.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new w(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(D.min())?Z.exists(!1):Z.updateTime(t):Z.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(D.min()))throw new w(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Z.updateTime(t)}return Z.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class hy{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.kc=r.maxAttempts,this.No=new Co(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.No.Ro((0,y.Z)(function*(){const t=new ly(e.datastore),r=e.Mc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.Fc(i)}))}).catch(s=>{e.Fc(s)})}))}Mc(e){try{const t=this.updateFunction(e);return!Zn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!ll(t)}return!1}}class dy{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ae.UNAUTHENTICATED,this.clientId=_c.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,y.Z)(function*(a){I("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(I("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,y.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new w(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new re;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,y.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=vn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Wh(n,e){return Ca.apply(this,arguments)}function Ca(){return Ca=(0,y.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,y.Z)(function*(i){r.isEqual(i)||(yield ch(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Ca.apply(this,arguments)}function Yh(n,e){return Da.apply(this,arguments)}function Da(){return Da=(0,y.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Aa(n);I("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>Sh(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>Sh(e.remoteStore,i)),n.onlineComponents=e}),Da.apply(this,arguments)}function Aa(n){return Na.apply(this,arguments)}function Na(){return Na=(0,y.Z)(function*(n){return n.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),yield Wh(n,new Vh)),n.offlineComponents}),Na.apply(this,arguments)}function Us(n){return ka.apply(this,arguments)}function ka(){return ka=(0,y.Z)(function*(n){return n.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),yield Yh(n,new Ta)),n.onlineComponents}),ka.apply(this,arguments)}function Xh(n){return Aa(n).then(e=>e.persistence)}function Bs(n){return Aa(n).then(e=>e.localStore)}function Ra(n){return Us(n).then(e=>e.remoteStore)}function Ma(n){return Us(n).then(e=>e.syncEngine)}function xn(n){return La.apply(this,arguments)}function La(){return La=(0,y.Z)(function*(n){const e=yield Us(n),t=e.eventManager;return t.onListen=qp.bind(null,e.syncEngine),t.onUnlisten=Gp.bind(null,e.syncEngine),t}),La.apply(this,arguments)}function ed(n,e,t={}){const r=new re;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function(s,i,o,a,u){const c=new Vs({next:h=>{i.enqueueAndForget(()=>Ho(s,l));const d=h.docs.has(o);!d&&h.fromCache?u.reject(new w(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&"server"===a.source?u.reject(new w(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new Xo(nn(o.path),c,{includeMetadataChanges:!0,ku:!0});return zo(s,l)}(yield xn(n),n.asyncQueue,e,t,r)})),r.promise}function td(n,e,t={}){const r=new re;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function(s,i,o,a,u){const c=new Vs({next:h=>{i.enqueueAndForget(()=>Ho(s,l)),h.fromCache&&"server"===a.source?u.reject(new w(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new Xo(o,c,{includeMetadataChanges:!0,ku:!0});return zo(s,l)}(yield xn(n),n.asyncQueue,e,t,r)})),r.promise}class Iy{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.No=new Co(this,"async_queue_retry"),this.Wc=()=>{const t=Ms();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.No.Po()};const e=Ms();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const t=Ms();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const t=new re;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,y.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.No.reset()}catch(t){if(!et(t))throw t;I("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.No.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,ee("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const s=Qo.createAndSchedule(this,e,t,r,i=>this.Yc(i));return this.qc.push(s),s}zc(){this.Kc&&b()}verifyOperationInProgress(){}Xc(){var e=this;return(0,y.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.qc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.qc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.qc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.qc.indexOf(e);this.qc.splice(t,1)}}function Fa(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class _y{constructor(){this._progressObserver={},this._taskCompletionResolver=new re,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class $ extends xr{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Iy,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||nd(this),this._firestoreClient.terminate()}}function te(n){return n._firestoreClient||nd(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function nd(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Mm(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new dy(n._authCredentials,n._appCheckCredentials,n._queue,r)}function rd(n,e,t){const r=new re;return n.asyncQueue.enqueue((0,y.Z)(function*(){try{yield Wh(n,t),yield Yh(n,e),r.resolve()}catch(s){const i=s;if(!("FirebaseError"===(o=i).name?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw i;_t("Error enabling offline persistence. Falling back to persistence disabled: "+i),r.reject(i)}var o})).then(()=>r.promise)}function sd(n){if(n._initialized||n._terminated)throw new w(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Be{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Be(se.fromBase64String(e))}catch(t){throw new w(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Be(se.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ze{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new w(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new W(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ut{constructor(e){this._methodName=e}}class qs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new w(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new w(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return N(this._lat,e._lat)||N(this._long,e._long)}}const ky=/^__.*__$/;class Ry{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new $e(e,this.data,this.fieldMask,t,this.fieldTransforms):new an(e,this.data,t,this.fieldTransforms)}}class id{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new $e(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function od(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw b()}}class Gs{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.It=r,this.ignoreUndefinedProperties=s,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Gs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ia({path:r,oa:!1});return s.ua(e),s}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ia({path:r,oa:!1});return s.na(),s}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return $s(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(od(this.sa)&&ky.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class My{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.It=r||wr(e)}da(e,t,r,s=!1){return new Gs({sa:e,methodName:t,fa:r,path:W.emptyPath(),oa:!1,la:s},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function Bt(n){const e=n._freezeSettings(),t=wr(n._databaseId);return new My(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ks(n,e,t,r,s,i={}){const o=n.da(i.merge||i.mergeFields?2:0,e,t,s);Ua("Data must be an object, but it was:",o,r);const a=cd(r,o);let u,c;if(i.merge)u=new Ae(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const h of i.mergeFields){const d=Ba(e,h,t);if(!o.contains(d))throw new w(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);hd(l,d)||l.push(d)}u=new Ae(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Ry(new me(a),u,c)}class Er extends Ut{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Er}}function ad(n,e,t){return new Gs({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.It,e.ignoreUndefinedProperties)}class Oa extends Ut{_toFieldTransform(e){return new tr(e.path,new sn)}isEqual(e){return e instanceof Oa}}class Ly extends Ut{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=ad(this,e,!0),r=this._a.map(i=>qt(i,t)),s=new At(r);return new tr(e.path,s)}isEqual(e){return this===e}}class Fy extends Ut{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=ad(this,e,!0),r=this._a.map(i=>qt(i,t)),s=new Nt(r);return new tr(e.path,s)}isEqual(e){return this===e}}class Oy extends Ut{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new on(e.It,Jc(e.It,this.wa));return new tr(e.path,t)}isEqual(e){return this===e}}function Pa(n,e,t,r){const s=n.da(1,e,t);Ua("Data must be an object, but it was:",s,r);const i=[],o=me.empty();Tt(r,(u,c)=>{const l=js(e,u,t);c=(0,q.m9)(c);const h=s.ca(l);if(c instanceof Er)i.push(l);else{const d=qt(c,h);null!=d&&(i.push(l),o.set(l,d))}});const a=new Ae(i);return new id(o,a,s.fieldTransforms)}function Va(n,e,t,r,s,i){const o=n.da(1,e,t),a=[Ba(e,r,t)],u=[s];if(i.length%2!=0)throw new w(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(Ba(e,i[d])),u.push(i[d+1]);const c=[],l=me.empty();for(let d=a.length-1;d>=0;--d)if(!hd(c,a[d])){const p=a[d];let v=u[d];v=(0,q.m9)(v);const E=o.ca(p);if(v instanceof Er)c.push(p);else{const T=qt(v,E);null!=T&&(c.push(p),l.set(p,T))}}const h=new Ae(c);return new id(l,h,o.fieldTransforms)}function ud(n,e,t,r=!1){return qt(t,n.da(r?4:3,e))}function qt(n,e){if(ld(n=(0,q.m9)(n)))return Ua("Unsupported field value:",e,n),cd(n,e);if(n instanceof Ut)return function(t,r){if(!od(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=qt(o,r.aa(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,q.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Jc(r.It,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=z.fromDate(t);return{timestampValue:ar(r.It,s)}}if(t instanceof z){const s=new z(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ar(r.It,s)}}if(t instanceof qs)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Be)return{bytesValue:Il(r.It,t._byteString)};if(t instanceof j){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.ha(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:no(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${Os(t)}`)}(n,e)}function cd(n,e){const t={};return Ac(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Tt(n,(r,s)=>{const i=qt(s,e.ra(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function ld(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof z||n instanceof qs||n instanceof Be||n instanceof j||n instanceof Ut)}function Ua(n,e,t){if(!ld(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Os(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function Ba(n,e,t){if((e=(0,q.m9)(e))instanceof Ze)return e._internalPath;if("string"==typeof e)return js(n,e);throw $s("Field path arguments must be of type string or ",n,!1,void 0,t)}const Py=new RegExp("[~\\*/\\[\\]]");function js(n,e,t){if(e.search(Py)>=0)throw $s(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ze(...e.split("."))._internalPath}catch{throw $s(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function $s(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new w(m.INVALID_ARGUMENT,a+n+u)}function hd(n,e){return n.some(t=>t.isEqual(e))}class Tr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new j(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Vy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Qs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Vy extends Tr{data(){return super.data()}}function Qs(n,e){return"string"==typeof e?js(n,e):e instanceof Ze?e._internalPath:e._delegate._internalPath}function dd(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new w(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class br{}function ht(n,...e){for(const t of e)n=t._apply(n);return n}class Uy extends br{constructor(e,t,r){super(),this.ma=e,this.ga=t,this.ya=r,this.type="where"}_apply(e){const t=Bt(e.firestore),r=function(s,i,o,a,u,c,l){let h;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new w(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){vd(l,c);const p=[];for(const v of l)p.push(yd(a,s,v));h={arrayValue:{values:p}}}else h=yd(a,s,l)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||vd(l,c),h=ud(o,"where",l,"in"===c||"not-in"===c);const d=ge.create(u,c,h);return function(p,v){if(v.dt()){const T=Yi(p);if(null!==T&&!T.isEqual(v.field))throw new w(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${T.toString()}' and '${v.field.toString()}'`);const P=Wi(p);null!==P&&wd(0,v.field,P)}const E=function(T,P){for(const G of T.filters)if(P.indexOf(G.op)>=0)return G.op;return null}(p,function(T){switch(T){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(v.op));if(null!==E)throw new w(m.INVALID_ARGUMENT,E===v.op?`Invalid query. You cannot use more than one '${v.op.toString()}' filter.`:`Invalid query. You cannot use '${v.op.toString()}' filters with '${E.toString()}' filters.`)}(s,d),d}(e._query,0,t,e.firestore._databaseId,this.ma,this.ga,this.ya);return new ve(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new je(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}class qy extends br{constructor(e,t){super(),this.ma=e,this.pa=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new w(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new w(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new tn(s,i);return function(a,u){if(null===Wi(a)){const c=Yi(a);null!==c&&wd(0,c,u.field)}}(r,o),o}(e._query,this.ma,this.pa);return new ve(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new je(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class fd extends br{constructor(e,t,r){super(),this.type=e,this.Ia=t,this.Ta=r}_apply(e){return new ve(e.firestore,e.converter,ms(e._query,this.Ia,this.Ta))}}class md extends br{constructor(e,t,r){super(),this.type=e,this.Ea=t,this.Aa=r}_apply(e){const t=pd(e,this.type,this.Ea,this.Aa);return new ve(e.firestore,e.converter,(s=t,new je((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class gd extends br{constructor(e,t,r){super(),this.type=e,this.Ea=t,this.Aa=r}_apply(e){const t=pd(e,this.type,this.Ea,this.Aa);return new ve(e.firestore,e.converter,(s=t,new je((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function pd(n,e,t,r){if(t[0]=(0,q.m9)(t[0]),t[0]instanceof Tr)return function(s,i,o,a,u){if(!a)throw new w(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const l of rn(s))if(l.field.isKeyField())c.push(Ct(i,a.key));else{const h=a.data.field(l.field);if(zi(h))throw new w(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){const d=l.field.canonicalString();throw new w(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}c.push(h)}return new it(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Bt(n.firestore);return function(i,o,a,u,c,l){const h=i.explicitOrderBy;if(c.length>h.length)throw new w(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let p=0;p<c.length;p++){const v=c[p];if(h[p].field.isKeyField()){if("string"!=typeof v)throw new w(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof v}`);if(!Xi(i)&&-1!==v.indexOf("/"))throw new w(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${v}' contains a slash.`);const E=i.path.child(L.fromString(v));if(!_.isDocumentKey(E))throw new w(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${E}' is not because it contains an odd number of segments.`);const T=new _(E);d.push(Ct(o,T))}else{const E=ud(a,u,v);d.push(E)}}return new it(d,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function yd(n,e,t){if("string"==typeof(t=(0,q.m9)(t))){if(""===t)throw new w(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xi(e)&&-1!==t.indexOf("/"))throw new w(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(L.fromString(t));if(!_.isDocumentKey(r))throw new w(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ct(n,new _(r))}if(t instanceof j)return Ct(n,t._key);throw new w(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Os(t)}.`)}function vd(n,e){if(!Array.isArray(n)||0===n.length)throw new w(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new w(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function wd(n,e,t){if(!t.isEqual(e))throw new w(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class qa{convertValue(e,t="none"){switch(St(e)){case 0:return null;case 1:return e.booleanValue;case 2:return X(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw b()}}convertObject(e,t){const r={};return Tt(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new qs(X(e.latitude),X(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=kc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zn(e));default:return null}}convertTimestamp(e){const t=tt(e);return new z(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=L.fromString(e);C(Al(r));const s=new nt(r.get(1),r.get(3)),i=new _(r.popFirst(5));return s.isEqual(t)||ee(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function zs(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Hy extends qa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Be(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new j(this.firestore,null,t)}}class Gt{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class He extends Tr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Sr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Qs("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Sr extends He{data(e={}){return super.data(e)}}class dt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Gt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Sr(this._firestore,this._userDataWriter,r.key,r,new Gt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new w(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new Sr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Gt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new Sr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Gt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:Wy(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Wy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return b()}}function Id(n,e){return n instanceof He&&e instanceof He?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof dt&&e instanceof dt&&n._firestore===e._firestore&&Sa(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class ft extends qa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Be(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new j(this.firestore,null,t)}}function _d(n,e,t){n=M(n,j);const r=M(n.firestore,$),s=zs(n.converter,e,t);return En(r,[Ks(Bt(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,Z.none())])}function xd(n,e,t,...r){n=M(n,j);const s=M(n.firestore,$),i=Bt(s);let o;return o="string"==typeof(e=(0,q.m9)(e))||e instanceof Ze?Va(i,"updateDoc",n._key,e,t,r):Pa(i,"updateDoc",n._key,e),En(s,[o.toMutation(n._key,Z.exists(!0))])}function Ed(n,...e){var t,r,s;n=(0,q.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Fa(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Fa(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(s=h.complete)||void 0===s?void 0:s.bind(h)}let u,c,l;if(n instanceof j)c=M(n.firestore,$),l=nn(n._key.path),u={next:h=>{e[o]&&e[o](Ga(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=M(n,ve);c=M(h.firestore,$),l=h._query;const d=new ft(c);u={next:p=>{e[o]&&e[o](new dt(c,d,h,p))},error:e[o+1],complete:e[o+2]},dd(n._query)}return function(h,d,p,v){const E=new Vs(v),T=new Xo(d,E,p);return h.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return zo(yield xn(h),T)})),()=>{E.bc(),h.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return Ho(yield xn(h),T)}))}}(te(c),l,a,u)}function En(n,e){return function(t,r){const s=new re;return t.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function Kp(n,e,t){return ra.apply(this,arguments)}(yield Ma(t),r,s)})),s.promise}(te(n),e)}function Ga(n,e,t){const r=t.docs.get(e._key),s=new ft(n);return new He(n,s,e._key,r,new Gt(t.hasPendingWrites,t.fromCache),e.converter)}const ov={maxAttempts:5};class Td{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Bt(e)}set(e,t,r){this._verifyNotCommitted();const s=mt(e,this._firestore),i=zs(s.converter,t,r),o=Ks(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,Z.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=mt(e,this._firestore);let o;return o="string"==typeof(t=(0,q.m9)(t))||t instanceof Ze?Va(this._dataReader,"WriteBatch.update",i._key,t,r,s):Pa(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Z.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=mt(e,this._firestore);return this._mutations=this._mutations.concat(new un(t._key,Z.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new w(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mt(n,e){if((n=(0,q.m9)(n)).firestore!==e)throw new w(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class av extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Bt(e)}get(e){const t=mt(e,this._firestore),r=new Hy(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return b();const i=s[0];if(i.isFoundDocument())return new Tr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Tr(this._firestore,r,t._key,null,t.converter);throw b()})}set(e,t,r){const s=mt(e,this._firestore),i=zs(s.converter,t,r),o=Ks(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=mt(e,this._firestore);let o;return o="string"==typeof(t=(0,q.m9)(t))||t instanceof Ze?Va(this._dataReader,"Transaction.update",i._key,t,r,s):Pa(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=mt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=mt(e,this._firestore),r=new ft(this._firestore);return super.get(e).then(s=>new He(this._firestore,r,t._key,s._document,new Gt(!1,!1),t.converter))}}function Ka(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new w("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Sd(){if(typeof Uint8Array>"u")throw new w("unimplemented","Uint8Arrays are not available in this environment.")}function Cd(){if(!function km(){return typeof atob<"u"}())throw new w("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Yt=Rr.SDK_VERSION,(0,Rr._registerComponent)(new nu.wA("firestore",(t,{instanceIdentifier:r,options:s})=>{const i=t.getProvider("app").getImmediate(),o=new $(new wm(t.getProvider("auth-internal")),new xm(t.getProvider("app-check-internal")),function(a,u){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new w(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nt(a.options.projectId,u)}(i,r),i);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),(0,Rr.registerVersion)(vc,"3.7.1",n),(0,Rr.registerVersion)(vc,"3.7.1","esm2017")}();class Cr{constructor(e){this._delegate=e}static fromBase64String(e){return Cd(),new Cr(Be.fromBase64String(e))}static fromUint8Array(e){return Sd(),new Cr(Be.fromUint8Array(e))}toBase64(){return Cd(),this._delegate.toBase64()}toUint8Array(){return Sd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function ja(n){return function pv(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class yv{enableIndexedDbPersistence(e,t){return function Ey(n,e){sd(n=M(n,$));const t=te(n),r=n._freezeSettings(),s=new Ta;return rd(t,s,new Uh(s,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Ty(n){sd(n=M(n,$));const e=te(n),t=n._freezeSettings(),r=new Ta;return rd(e,r,new iy(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function by(n){if(n._initialized&&!n._terminated)throw new w(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new re;return n._queue.enqueueAndForgetEvenWhileRestricted((0,y.Z)(function*(){try{yield(t=(0,y.Z)(function*(r){if(!Re.C())return Promise.resolve();const s=r+"main";yield Re.delete(s)}),function(r){return t.apply(this,arguments)})(yo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Dd{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof nt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&_t("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Qh(n,e,t,r={}){var s;const i=(n=M(n,xr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&_t("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ae.MOCK_USER;else{o=(0,q.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new w(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ae(u)}n._authCredentials=new vm(new wc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function Cy(n){return function fy(n){return n.asyncQueue.enqueue((0,y.Z)(function*(){const e=yield Xh(n),t=yield Ra(n);return e.setNetworkEnabled(!0),function(r){const s=x(r);return s.wu.delete(0),Ir(s)}(t)}))}(te(n=M(n,$)))}(this._delegate)}disableNetwork(){return function Dy(n){return function my(n){return n.asyncQueue.enqueue((0,y.Z)(function*(){const e=yield Xh(n),t=yield Ra(n);return e.setNetworkEnabled(!1),(r=(0,y.Z)(function*(s){const i=x(s);i.wu.add(0),yield gn(i),i.yu.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(te(n=M(n,$)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Bh("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Sy(n){return function(e){const t=new re;return e.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function zp(n,e){return ua.apply(this,arguments)}(yield Ma(e),t)})),t.promise}(te(n=M(n,$)))}(this._delegate)}onSnapshotsInSync(e){return function iv(n,e){return function yy(n,e){const t=new Vs(e);return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return r=yield xn(n),s=t,x(r).bu.add(s),void s.next();var r,s})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return r=yield xn(n),s=t,void x(r).bu.delete(s);var r,s}))}}(te(n=M(n,$)),Fa(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new w("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Tn(this,zh(this._delegate,e))}catch(t){throw xe(t,"collection()","Firestore.collection()")}}doc(e){try{return new ke(this,Ps(this._delegate,e))}catch(t){throw xe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ee(this,function oy(n,e){if(n=M(n,xr),ba("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new w(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ve(n,null,(t=e,new je(L.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw xe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function uv(n,e,t){n=M(n,$);const r=Object.assign(Object.assign({},ov),t);return function(s){if(s.maxAttempts<1)throw new w(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,i,o){const a=new re;return s.asyncQueue.enqueueAndForget((0,y.Z)(function*(){const u=yield function Jh(n){return Us(n).then(e=>e.datastore)}(s);new hy(s.asyncQueue,u,o,i,a).run()})),a.promise}(te(n),s=>e(new av(n,s)),r)}(this._delegate,t=>e(new Ad(this,t)))}batch(){return te(this._delegate),new Nd(new Td(this._delegate,e=>En(this._delegate,e)))}loadBundle(e){return function Ay(n,e){const t=te(n=M(n,$)),r=new _y;return function vy(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return Hh(u,c);if(u instanceof ArrayBuffer)return Hh(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new ay(u,o);var u}(t,wr(e));n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){!function sy(n,e,t){const r=x(n);var s;(s=(0,y.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(d,p){const v=x(d),E=ue(p.createTime);return v.persistence.runTransaction("hasNewerBundle","readonly",T=>v.Ns.getBundleMetadata(T,p.id)).then(T=>!!T&&T.createTime.compareTo(E)>=0)}(i.localStore,u))return yield o.close(),a._completeWith({taskState:"Success",documentsLoaded:(d=u).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}),Promise.resolve(new Set);a._updateProgress(Ah(u));const c=new Pp(u,i.localStore,o.It);let l=yield o.mc();for(;l;){const d=yield c.Fu(l);d&&a._updateProgress(d),l=yield o.mc()}const h=yield c.complete();return yield ze(i,h.Lu,void 0),yield function(d,p){const v=x(d);return v.persistence.runTransaction("Save bundle","readwrite",E=>v.Ns.saveBundleMetadata(E,p))}(i.localStore,u),a._completeWith(h.progress),Promise.resolve(h.Bu)}catch(u){return _t("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}var d}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}(yield Ma(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Ny(n,e){return function wy(n,e){return n.asyncQueue.enqueue((0,y.Z)(function*(){return function(t,r){const s=x(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ns.getNamedQuery(i,r))}(yield Bs(n),e)}))}(te(n=M(n,$)),e).then(t=>t?new ve(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Ee(this,t):null)}}class Zs extends qa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(new Be(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return ke.forKey(t,this.firestore,null)}}class Ad{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Zs(e)}get(e){const t=jt(e);return this._delegate.get(t).then(r=>new Dr(this._firestore,new He(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=jt(e);return r?(Ka("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=jt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=jt(e);return this._delegate.delete(t),this}}class Nd{constructor(e){this._delegate=e}set(e,t,r){const s=jt(e);return r?(Ka("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=jt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=jt(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Kt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Sr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ar(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Kt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new Kt(e,new Zs(e),t),s.set(t,i)),i}}Kt.INSTANCES=new WeakMap;class ke{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zs(e)}static forPath(e,t,r){if(e.length%2!=0)throw new w("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new ke(t,new j(t._delegate,r,new _(e)))}static forKey(e,t,r){return new ke(t,new j(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Tn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Tn(this.firestore,zh(this._delegate,e))}catch(t){throw xe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,q.m9)(e))instanceof j&&Zh(this._delegate,e)}set(e,t){t=Ka("DocumentReference.set",t);try{return t?_d(this._delegate,e,t):_d(this._delegate,e)}catch(r){throw xe(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?xd(this._delegate,e):xd(this._delegate,e,t,...r)}catch(s){throw xe(s,"updateDoc()","DocumentReference.update()")}}delete(){return function rv(n){return En(M(n.firestore,$),[new un(n._key,Z.none())])}(this._delegate)}onSnapshot(...e){const t=kd(e),r=Rd(e,s=>new Dr(this.firestore,new He(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Ed(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function Xy(n){n=M(n,j);const e=M(n.firestore,$),t=te(e),r=new ft(e);return function gy(n,e){const t=new re;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return(r=(0,y.Z)(function*(s,i,o){try{const a=yield function(u,c){const l=x(u);return l.persistence.runTransaction("read document","readonly",h=>l.localDocuments.getDocument(h,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new w(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=vn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Bs(n),e,t);var r})),t.promise}(t,n._key).then(s=>new He(e,r,n._key,s,new Gt(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function Jy(n){n=M(n,j);const e=M(n.firestore,$);return ed(te(e),n._key,{source:"server"}).then(t=>Ga(e,n,t))}(this._delegate):function Yy(n){n=M(n,j);const e=M(n.firestore,$);return ed(te(e),n._key).then(t=>Ga(e,n,t))}(this._delegate),t.then(r=>new Dr(this.firestore,new He(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new ke(this.firestore,this._delegate.withConverter(e?Kt.getInstance(this.firestore,e):null))}}function xe(n,e,t){return n.message=n.message.replace(e,t),n}function kd(n){for(const e of n)if("object"==typeof e&&!ja(e))return e;return{}}function Rd(n,e){var t,r;let s;return s=ja(n[0])?n[0]:ja(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Dr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ke(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Id(this._delegate,e._delegate)}}class Ar extends Dr{data(e){const t=this._delegate.data(e);return function pm(n,e){n||b()}(void 0!==t),t}}class Ee{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zs(e)}where(e,t,r){try{return new Ee(this.firestore,ht(this._delegate,function By(n,e,t){const r=e,s=Qs("where",n);return new Uy(s,r,t)}(e,t,r)))}catch(s){throw xe(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ee(this.firestore,ht(this._delegate,function Gy(n,e="asc"){const t=e,r=Qs("orderBy",n);return new qy(r,t)}(e,t)))}catch(r){throw xe(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ee(this.firestore,ht(this._delegate,function Ky(n){return Kh("limit",n),new fd("limit",n,"F")}(e)))}catch(t){throw xe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Ee(this.firestore,ht(this._delegate,function jy(n){return Kh("limitToLast",n),new fd("limitToLast",n,"L")}(e)))}catch(t){throw xe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ee(this.firestore,ht(this._delegate,function $y(...n){return new md("startAt",n,!0)}(...e)))}catch(t){throw xe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ee(this.firestore,ht(this._delegate,function Qy(...n){return new md("startAfter",n,!1)}(...e)))}catch(t){throw xe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ee(this.firestore,ht(this._delegate,function zy(...n){return new gd("endBefore",n,!1)}(...e)))}catch(t){throw xe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ee(this.firestore,ht(this._delegate,function Zy(...n){return new gd("endAt",n,!0)}(...e)))}catch(t){throw xe(t,"endAt()","Query.endAt()")}}isEqual(e){return Sa(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function tv(n){n=M(n,ve);const e=M(n.firestore,$),t=te(e),r=new ft(e);return function py(n,e){const t=new re;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return(r=(0,y.Z)(function*(s,i,o){try{const a=yield Ns(s,i,!0),u=new Rh(i,a.Hi),c=u.Wu(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){const u=vn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Bs(n),e,t);var r})),t.promise}(t,n._query).then(s=>new dt(e,r,n,s))}(this._delegate):"server"===e?.source?function nv(n){n=M(n,ve);const e=M(n.firestore,$),t=te(e),r=new ft(e);return td(t,n._query,{source:"server"}).then(s=>new dt(e,r,n,s))}(this._delegate):function ev(n){n=M(n,ve);const e=M(n.firestore,$),t=te(e),r=new ft(e);return dd(n._query),td(t,n._query).then(s=>new dt(e,r,n,s))}(this._delegate),t.then(r=>new $a(this.firestore,new dt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=kd(e),r=Rd(e,s=>new $a(this.firestore,new dt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Ed(this._delegate,t,r)}withConverter(e){return new Ee(this.firestore,this._delegate.withConverter(e?Kt.getInstance(this.firestore,e):null))}}class wv{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ar(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class $a{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ee(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ar(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new wv(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ar(this._firestore,r))})}isEqual(e){return Id(this._delegate,e._delegate)}}class Tn extends Ee{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new ke(this.firestore,e):null}doc(e){try{return new ke(this.firestore,void 0===e?Ps(this._delegate):Ps(this._delegate,e))}catch(t){throw xe(t,"doc()","CollectionReference.doc()")}}add(e){return function sv(n,e){const t=M(n.firestore,$),r=Ps(n),s=zs(n.converter,e);return En(t,[Ks(Bt(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,Z.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new ke(this.firestore,t))}isEqual(e){return Zh(this._delegate,e._delegate)}withConverter(e){return new Tn(this.firestore,this._delegate.withConverter(e?Kt.getInstance(this.firestore,e):null))}}function jt(n){return M(n,j)}class Qa{constructor(...e){this._delegate=new Ze(...e)}static documentId(){return new Qa(W.keyField().canonicalString())}isEqual(e){return(e=(0,q.m9)(e))instanceof Ze&&this._delegate._internalPath.isEqual(e._internalPath)}}class $t{constructor(e){this._delegate=e}static serverTimestamp(){const e=function lv(){return new Oa("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new $t(e)}static delete(){const e=function cv(){return new Er("deleteField")}();return e._methodName="FieldValue.delete",new $t(e)}static arrayUnion(...e){const t=function hv(...n){return new Ly("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new $t(t)}static arrayRemove(...e){const t=function dv(...n){return new Fy("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new $t(t)}static increment(e){const t=function fv(n){return new Oy("increment",n)}(e);return t._methodName="FieldValue.increment",new $t(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Iv={Firestore:Dd,GeoPoint:qs,Timestamp:z,Blob:Cr,Transaction:Ad,WriteBatch:Nd,DocumentReference:ke,DocumentSnapshot:Dr,Query:Ee,QueryDocumentSnapshot:Ar,QuerySnapshot:$a,CollectionReference:Tn,FieldPath:Qa,FieldValue:$t,setLogLevel:function vv(n){!function gm(n){Xe.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function xv(n){(function _v(n,e){n.INTERNAL.registerComponent(new nu.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps(Object.assign({},Iv)))})(n,(e,t)=>new Dd(e,t,new yv)),n.registerVersion("@firebase/firestore-compat","0.2.1")}(hf.Z);var gt=R(0),Ev=R(5849);function Md(n,e){return function Tv(n,e=sf.z){return new of.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function za(n,e){return Md(n,e).pipe((0,Me.U)(t=>({payload:t,type:"query"})))}function Hs(n,e){return za(n,e).pipe(Xs(void 0),Js(),(0,Me.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),c=t?.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function Ld(n,e,t){return Hs(n,t).pipe((0,ei.R)((r,s)=>function Sv(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function Cv(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Za(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Za(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Za(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,lf.x)(),(0,Me.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function Za(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function Fd(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}R(7841);class Od{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Hs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Me.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe(Xs(void 0),Js(),(0,tu.h)(([r,s])=>s.length>0||!r),(0,Me.U)(([r,s])=>s),Ne.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,ei.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Fd(e);return Ld(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}valueChanges(e={}){return za(this.query,this.afs.schedulers.outsideAngular).pipe((0,Me.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Ne.iC)}get(e){return(0,bn.D)(this.query.get(e)).pipe(Ne.iC)}add(e){return this.ref.add(e)}doc(e){return new Pd(this.ref.doc(e),this.afs)}}class Pd{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=Vd(r,t);return new Od(s,i,this.afs)}snapshotChanges(){return function bv(n,e){return Md(n,e).pipe(Xs(void 0),Js(),(0,Me.U)(([t,r])=>r.exists?t?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Me.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,bn.D)(this.ref.get(e)).pipe(Ne.iC)}}class Dv{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Hs(this.query,this.afs.schedulers.outsideAngular).pipe((0,Me.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,tu.h)(t=>t.length>0),Ne.iC):Hs(this.query,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,ei.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Fd(e);return Ld(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}valueChanges(e={}){return za(this.query,this.afs.schedulers.outsideAngular).pipe((0,Me.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),Ne.iC)}get(e){return(0,bn.D)(this.query.get(e)).pipe(Ne.iC)}}const Av=new g.OlP("angularfire2.enableFirestorePersistence"),Nv=new g.OlP("angularfire2.firestore.persistenceSettings"),kv=new g.OlP("angularfire2.firestore.settings"),Rv=new g.OlP("angularfire2.firestore.use-emulator");function Vd(n,e=(t=>t)){return{query:e(n),ref:n}}let Mv=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,h,d,p,v,E,T,P,G){this.schedulers=u;const O=(0,kr.on)(t,a,r),J=l;h&&(0,gt.nw)(O,a,d,v,E,T,p,P),[this.firestore,this.persistenceEnabled$]=(0,kr.cc)(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{const V=a.runOutsideAngular(()=>O.firestore());if(i&&V.settings(i),J&&V.useEmulator(...J),s&&!(0,Qt.PM)(o)){const U=()=>{try{return(0,bn.D)(V.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ie){return typeof console<"u"&&console.warn(ie),(0,Ya.of)(!1)}};return[V,a.runOutsideAngular(U)]}return[V,(0,Ya.of)(!1)]},[i,J,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=Vd(s,r),a=this.schedulers.ngZone.run(()=>i);return new Od(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Dv(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new Pd(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(kr.Dh),g.LFG(kr.xv,8),g.LFG(Av,8),g.LFG(kv,8),g.LFG(g.Lbi),g.LFG(g.R0b),g.LFG(Ne.HU),g.LFG(Nv,8),g.LFG(Rv,8),g.LFG(gt.zQ,8),g.LFG(gt.Qv,8),g.LFG(gt.L6,8),g.LFG(gt._Q,8),g.LFG(gt.rT,8),g.LFG(gt.lh,8),g.LFG(gt.f7,8),g.LFG(Ev.nm,8))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Lv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=g.oAB({type:n}),n.\u0275inj=g.cJS({providers:[Ys.yM,Wa,Mv],imports:[Ws.Bz.forChild([{path:"",component:ef,resolve:{aboutPage:Wa}}]),Ud.m,tf.b,rf.Y]}),n})()}}]);